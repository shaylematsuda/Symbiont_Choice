---
title: "Symb_Choice_ddPCR"
author: "Shayle Matsuda"
date: "04/11/21"
output: html_document
editor_options: 
  chunk_output_type: console
---

Data analysis of the Symbiont Choice 2018 experiment conducted at AIMS in 2018 and 2019. 

Authors: Matsuda, SB, Chakravarti, LC, Cunning, JR, Huffmyer, AS, Nelson, CE, Gates, RD, van Oppen, MJH
Symbiont choice experiment tests the uptake of cultured Symbiodiniaceae alone and as a mixture in A. tenuis larvae at ambient (27C) and two elevated (30C and 31C) temperatures over the course of 2 weeks. Sampling was on days 3, 7 and 14. Digital droplet PCR was used to analyze data. 

Single infection: Individual infection of single clades: C1, D1, F1, and G3
Multi-infection: Mix of all four clades 
Pot: the containers larvae kept in (3 reps/clade/temp)
4-way (coded as poly in some instances)

```{r setup chunk, setup, warning=FALSE, message=FALSE, fig.align='center'}
require("knitr")
```


Load in libraries 
```{r}    
#rm(list=ls()) # Clear workspace

# Set up workspace:
library(lmodel2) 
library(MASS)
library(reshape) #for cast
library(lattice)
library(dplyr)
library(plyr)
library(ggplot2)
library(cowplot)
library("gridExtra") #arrange plots for output
library(reshape2)
library("ggsci")#set bar colors for locustzoom
library("plotrix") #functions in tapply
library("pscl")
library("car") #levenes test
library("lsmeans")
library(effects)
library("multcomp") 
library("multcompView")
library("vegan") #calculating distance matrices
library(MuMIn)
library(lme4)
library(lmerTest)
library(PMCMR)
library(tidyverse)
library(jtools)
library(broom)
library(emmeans)
library(ggordiplots)
library(moments)
library(ggpubr)
library(vegan)


#load in df
load("Symbiont_choice_df.RData")


```

#Regression 
Scope/hemo Calc means for clade/temp/time/pot VS ddPCR

Model2 regression: Do ddPCR counts differe significantly from hemocytometer + scope counts?
For individual infections, we additionally counted symbionts by eye (flurescent scope) on Day 3, and by hemoctyometer (Days 7 and 14) per instrument capacity. Running a model2 analysis, we show that the slope of ddPCR x scope/hemo counts is not different than 1.  
```{r}  
#Model_II_linear_regression   

#log ddpcr and counts
scopehemo_ddPCRCompare$Countmean_log<-log10(scopehemo_ddPCRCompare$Countmean+1) #log10 the hemo/scope counts
hist(scopehemo_ddPCRCompare$Countmean_log)
scopehemo_ddPCRCompare$ddPCRmean_log<-log10(scopehemo_ddPCRCompare$ddPCRmean+1) #log10 the ddPCR counts
hist(scopehemo_ddPCRCompare$ddPCRmean_log)

#ScopeHemo ddPCR  
lmodel2(ddPCRmean_log~Countmean_log, data = scopehemo_ddPCRCompare)

#Scope vs ddPCR
scope_ddPCRCompare<-subset(scopehemo_ddPCRCompare, count.type.x=="scope")
lmodel2(ddPCRmean_log~Countmean_log, data = scope_ddPCRCompare)

#Hemo vs ddPCR
hemo_ddPCRCompare<-subset(scopehemo_ddPCRCompare, count.type.x=="hemo")
lmodel2(ddPCRmean_log~Countmean_log, data = hemo_ddPCRCompare)

#MODEL:
CountsMOD4<-lm(ddPCRmean_log ~ Countmean_log + Countmean_log*count.type.x,data = scopehemo_ddPCRCompare)
anova(CountsMOD4)

```

Plot: logged10 SI Fig 1   
```{r}   
# plotting the model2
#map 50% conf interval
ggplot(data=scopehemo_ddPCRCompare,aes(x=Countmean_log, y=ddPCRmean_log)) +
   geom_point(aes(colour=factor(count.type.x), size=4)) +
   scale_colour_manual(name="condition",
       values=c("darkgray","orange"))+
        theme_classic()+
        geom_abline(intercept = 0, slope = 1.04) 
```

Monocultures and the polyculture 
Apply hemo.scope conversion and remake df with raw counts
```{r}   
#Convert Scope/hemo data, remake df with ddPCR data. Make new col with "raw" counts post conversion of logs
#C1 
C1FullddPCR<-subset(C1Full, count.type=="ddPCR")
C1Fullscopehemo<-subset(C1Full, count.type=="hemo"|count.type=="scope")
#C1Fullscopehemo$cells.larvae_log_Pre<-C1Fullscopehemo$cells.larvae_log #save old to check then comment out
C1Fullscopehemo$cells.larvae_log<-(C1Fullscopehemo$cells.larvae_log*0.96) #convert and check
C1Full<-rbind(C1FullddPCR,C1Fullscopehemo) #rebind with ddPCR
C1Full$cells.larvae_counts_unlog<-(10^C1Full$cells.larvae_log)-1  #converted all log back to Raw counts to check
#C1Full$cells.larvae_counts_round<-round(C1Full$cells.larvae_counts)

 
#D1
D1FullddPCR<-subset(D1Full, count.type=="ddPCR")
D1Fullscopehemo<-subset(D1Full, count.type=="hemo"|count.type=="scope")
#D1Fullscopehemo$cells.larvae_log_Pre<-D1Fullscopehemo$cells.larvae_log #save old to check then comment out
D1Fullscopehemo$cells.larvae_log<-(D1Fullscopehemo$cells.larvae_log*0.96) #convert and check
#plot(D1Fullscopehemo$cells.larvae_log, D1Fullscopehemo$cells.larvae_log) #check
D1Full<-rbind(D1FullddPCR,D1Fullscopehemo) #rebind with ddPCR
D1Full$cells.larvae_counts_unlog<-(10^D1Full$cells.larvae_log)-1  #converted all log back to Raw counts
#D1Full$cells.larvae_counts_round<-round(D1Full$cells.larvae_counts)
#plot(D1Full$cells.larvae, D1Full$cells.larvae_counts_round) #check

#F1
F1FullddPCR<-subset(F1Full, count.type=="ddPCR")
F1Fullscopehemo<-subset(F1Full, count.type=="hemo"|count.type=="scope")
#F1Fullscopehemo$cells.larvae_log_Pre<-F1Fullscopehemo$cells.larvae_log #save old to check then comment out
F1Fullscopehemo$cells.larvae_log<-(F1Fullscopehemo$cells.larvae_log*0.97) #convert and check
F1Full<-rbind(F1FullddPCR,F1Fullscopehemo) #rebind with ddPCR
F1Full$cells.larvae_counts_unlog<-(10^F1Full$cells.larvae_log)-1  #converted all log back to Raw counts
#F1Full$cells.larvae_counts_round<-round(F1Full$cells.larvae_counts)
#plot(F1Full$cells.larvae, F1Full$cells.larvae_counts_round) #check

#G3
G3FullddPCR<-subset(G3Full, count.type=="ddPCR")
G3Fullscopehemo<-subset(G3Full, count.type=="hemo"|count.type=="scope")
#G3Fullscopehemo$cells.larvae_log_Pre<-G3Fullscopehemo$cells.larvae_log #save old to check then comment out
G3Fullscopehemo$cells.larvae_log<-(G3Fullscopehemo$cells.larvae_log*0.96) #convert and check
G3Full<-rbind(G3FullddPCR,G3Fullscopehemo) #rebind with ddPCR
G3Full$cells.larvae_counts_unlog<-(10^G3Full$cells.larvae_log)-1  #converted all log back to Raw counts
#G3Full$cells.larvae_counts_round<-round(G3Full$cells.larvae_counts)
#plot(G3Full$cells.larvae, G3Full$cells.larvae_counts_round) #check


#Poly
PolyFullddPCR<-subset(PolyFull, count.type=="ddPCR")
PolyFullscopehemo<-subset(PolyFull, count.type=="hemo"|count.type=="scope")
#PolyFullscopehemo$cells.larvae_log_Pre<-PolyFullscopehemo$cells.larvae_log #save old to check then comment out
PolyFullscopehemo$cells.larvae_log<-(PolyFullscopehemo$cells.larvae_log*0.96) #convert and check
PolyFull<-rbind(PolyFullddPCR,PolyFullscopehemo) #rebind with ddPCR
PolyFull$cells.larvae_counts_unlog<-(10^PolyFull$cells.larvae_log)-1  #converted Poly log back to Raw counts
#PolyFull$cells.larvae_counts_round<-round(PolyFull$cells.larvae_counts)
 
#plot(PolyFull$cells.larvae, PolyFull$cells.larvae_counts_round) #check
 
Monoculture<-rbind(C1Full,D1Full, F1Full, G3Full)
MonoPoly<-rbind(C1Full,D1Full, F1Full, G3Full,PolyFull)

```


# Larval Survivorship: Table S12, S13, Figure 6 
```{r}              
# No-choice and 4-way choice (remove control)
# binomial mixed effects model
Mort.df_NEW<-read.csv("SC_mortality_20200104.csv") #read mortality df
Mort.df_NEW$Temp<-as.factor(as.character(Mort.df_NEW$Temp))
Mort.df_NEW$Pot<-as.factor(as.character(Mort.df_NEW$Pot))
Mort.df_NEW$Day<-as.factor(as.character(Mort.df_NEW$Day))
Mort.df_NEW$Day <- factor(Mort.df_NEW$Day, levels = c("1", "7", "14"))

#calculation of survivorship by proportion
Mort.df_NEW$Surv<-(Mort.df_NEW$Alive)/(Mort.df_NEW$Alive+Mort.df_NEW$Failures)

#Summary
D.Summary <- ddply(Mort.df_NEW, c("Temp", "Symbiont","Day"), summarise,
                        N    = length(Surv[!is.na(Surv)]),
                        mean = mean(Surv, na.rm=TRUE)*100,
                        sd   = sd(Surv, na.rm=TRUE)*100,
                        se   = sd / sqrt(N)
)

D.Summary_2 <- ddply(Mort.df_NEW, c("Temp","Day"), summarise,
                        N    = length(Surv[!is.na(Surv)]),
                        mean = mean(Surv, na.rm=TRUE)*100,
                        sd   = sd(Surv, na.rm=TRUE)*100,
                        se   = sd / sqrt(N)
)
 
knitr::kable(D.Summary)
#remove day1 and remove Controls (no replication)
D.Summary<-subset(D.Summary, Day==7|Day==14)
Mort.df_NEW<-subset(Mort.df_NEW, Symbiont=="C1"|Symbiont=="D1"|Symbiont=="F1"|Symbiont=="G3"|Symbiont=="All")

#full model
##create binomial vector
attach(Mort.df_NEW)
x<-cbind(Alive, Failures)

#Analyze survivorship at the end of the thermal stress using a binomial mixed effects model.  
#Main effects: temperature, Symbiont treatment, time
#Run model and display summary as well as anova table for use of p-values.   

#Full model
Mort.df_NEW_mod<-glmer(x~Temp*Symbiont*Day + (1|Pot), family=binomial)
summary(Mort.df_NEW_mod)
Anova(Mort.df_NEW_mod)
 emm<-emmeans(Mort.df_NEW_mod,  ~Temp*Day|Symbiont, adjust="Tukey")
  cld(emm, Letter="abcdefg")
  pairs(emm)

 emm<-emmeans(Mort.df_NEW_mod,  ~ Symbiont|Temp|Day, adjust="Tukey")
  cld(emm, Letter="abcdefg")
  pairs(emm)

detach(Mort.df_NEW)
``` 
 
Plots of Mortality by TEMP
```{r} 
#subset
D.Summary_27<-subset(D.Summary, Temp==27)
D.Summary_30<-subset(D.Summary, Temp==30)
D.Summary_31<-subset(D.Summary, Temp==31)

#Plot total survivorship
#27C
FigSurv_D.Summary_27 <- ggplot(data=D.Summary_27, aes(x=Day, y=mean, group=interaction(Symbiont), colour=Symbiont, linetype=Symbiont)) + 
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=0, linetype="solid", position=position_dodge(0.05)) +
    geom_point(aes(color=Symbiont), position=position_dodge(0.05),size=4, show.legend = T)+ 
  geom_line(aes(color=Symbiont),linetype="dotted")+
    scale_color_manual(values=c('black', '#D43F3AFF','Grey','#EEA236FF','#5CB85CFF','#46B8DAFF'))+
           geom_point(shape = 1,size = 4,colour = "black",position=position_dodge(0.05) )+
  xlab(expression(bold("Day"))) +
  ylab(expression(bold("Survivorship (%)"))) +
  ylim(0,50) + 
  ggtitle("")+
  theme_classic() +
  theme(panel.background = element_blank()) +
    ggtitle("27C")+
  theme(text = element_text(size=20),
        panel.border = element_blank(), 
        plot.background =element_blank(),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(), 
        axis.line = element_line(colour = "black"),
        axis.text = element_text(size=18, colour="black"),
        legend.title=element_text(),
        legend.position=("right"),
        plot.title=element_text(), #Justify the title to the top left
        legend.text = element_text(size = 20),
        axis.title.y=element_text(margin=margin(0,7,0,0)), 
        axis.title.x=element_text(margin=margin(7,0,0,0)));FigSurv_D.Summary_27

FigSurv_D.Summary_30 <- ggplot(data=D.Summary_30, aes(x=Day, y=mean, group=interaction(Symbiont), colour=Symbiont, linetype=Symbiont)) + 
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=0, linetype="solid", position=position_dodge(0.05)) +
    geom_point(aes(color=Symbiont), position=position_dodge(0.05),size=4, show.legend = T)+ 
  geom_line(aes(color=Symbiont),linetype="dotted")+
    scale_color_manual(values=c('black', '#D43F3AFF','Grey','#EEA236FF','#5CB85CFF','#46B8DAFF'))+
           geom_point(shape = 1,size = 4,colour = "black",position=position_dodge(0.05) )+
  xlab(expression(bold("Day"))) +
  ylab(expression(bold("Survivorship (%)"))) +
  ylim(0,50) + 
  ggtitle("30C")+
  theme_classic() +
  theme(panel.background = element_blank()) +
  theme(text = element_text(size=20),
        panel.border = element_blank(), 
        plot.background =element_blank(),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(), 
        axis.line = element_line(colour = "black"),
        axis.text = element_text(size=18, colour="black"),
        legend.title=element_text(),
        legend.position=("right"),
        plot.title=element_text(), #Justify the title to the top left
        legend.text = element_text(size = 20),
        axis.title.y=element_text(margin=margin(0,7,0,0)), 
        axis.title.x=element_text(margin=margin(7,0,0,0)));FigSurv_D.Summary_30

FigSurv_D.Summary_31 <- ggplot(data=D.Summary_31, aes(x=Day, y=mean, group=interaction(Symbiont), colour=Symbiont, linetype=Symbiont)) + 
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=0, linetype="solid", position=position_dodge(0.05)) +
    geom_point(aes(color=Symbiont), position=position_dodge(0.05),size=4, show.legend = T)+ 
  geom_line(aes(color=Symbiont),linetype="dotted")+
    scale_color_manual(values=c('black', '#D43F3AFF','Grey','#EEA236FF','#5CB85CFF','#46B8DAFF'))+
         geom_point(shape = 1,size = 4,colour = "black",position=position_dodge(0.05) )+
  xlab(expression(bold("Day"))) +
  ylab(expression(bold("Survivorship (%)"))) +
  ylim(0,50) + 
  ggtitle("31C")+
  theme_classic() +
  theme(panel.background = element_blank()) +
  theme(text = element_text(size=20),
        panel.border = element_blank(), 
        plot.background =element_blank(),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(), 
        axis.line = element_line(colour = "black"),
        axis.text = element_text(size=18, colour="black"),
        legend.title=element_text(),
        legend.position=("right"),
        plot.title=element_text(), #Justify the title to the top left
        legend.text = element_text(size = 20),
        axis.title.y=element_text(margin=margin(0,7,0,0)), 
        axis.title.x=element_text(margin=margin(7,0,0,0)));FigSurv_D.Summary_31

#plot all together
FigSurv_D.Summary_27<-FigSurv_D.Summary_27+ theme(legend.position = "none") #remove legend
FigSurv_D.Summary_30<-FigSurv_D.Summary_30+ theme(legend.position = "none") #remove legend
FigSurv_D.Summary_31<-FigSurv_D.Summary_31+ theme(legend.position = "none") #remove legend

grid.arrange(FigSurv_D.Summary_27, FigSurv_D.Summary_30,FigSurv_D.Summary_31, nrow = 1)

```


# Binomial: Did a larvae infect (Y/N) modeles and plots
dfs: C1Full, D1Full, F1Full, G3Full, Poly
 
 
Make binomial dfs
Organize df for Polyculture: ddPCR and hemo./scope WORKS
```{r}           
#ALLcast_9000_cast2a for 4-way choice
#4-way df: create binary df, if at least one genus had >=1 cell, designate "1"
#organize the ddPCR data  
ALL_RelAb<-ALLcast_9000_cast2a #copy ddPCR df
drops <- c("C1","D1","F1","G3") #get rid of cell.larvae col
ALL_RelAb<-ALL_RelAb[ , !(names(ALL_RelAb) %in% drops)]

#make "infect or not"" binary df
RelA_binaryb<-ALL_RelAb 
 
 # 1 and 0 for each clade 
RelA_binaryb$C1[RelA_binaryb$C1>0]<-1  
RelA_binaryb$C1[RelA_binaryb$C1==0]<-0
RelA_binaryb$D1[RelA_binaryb$D1>0]<-1   
RelA_binaryb$D1[RelA_binaryb$D1==0]<-0
RelA_binaryb$F1[RelA_binaryb$F1>0]<-1  
RelA_binaryb$F1[RelA_binaryb$F1==0]<-0
RelA_binaryb$G3[RelA_binaryb$G3>0]<-1  
RelA_binaryb$G3[RelA_binaryb$G3==0]<-0

#new col sum of each clade in a larvae (Check to make sure NA are not changed to 0)
RelA_binaryb$numclade<-rowSums(RelA_binaryb[,c("C1", "D1","F1","G3")], na.rm=TRUE)
#remove the single row with only 0s and NAs to be conservative (rows with four 0s are 0)
RelA_binaryb<-RelA_binaryb[!(RelA_binaryb$ALL.number=="231"),]
#Create infect binary column 0 or 1

RelA_binaryb$Infect[RelA_binaryb$numclade>0]<-1  
RelA_binaryb$Infect[RelA_binaryb$numclade==0]<-0
RelA_binaryb$Infect<-as.factor(RelA_binaryb$Infect) #make factor

RelA_CladeComp<-RelA_binaryb #make a copy for the nextsection

# Combine ddPCR data with ALL scope/hemo converted counts for the BINOMIAL only df
  RelAvars<-c("Temp","Day","Pot","Infect") 
RelA_binaryb_2<-RelA_binaryb[RelAvars]
RelA_binaryb_2$count.type<-"ddPCR"

PolyCountvars<-c("Temp","Day","cells.larvae","Pot","count.type") #hemoscope prep
PolyFullscopehemo2<-PolyFullscopehemo[PolyCountvars]
PolyFullscopehemo2$Infect[PolyFullscopehemo2$cells.larvae>0]<-1  
PolyFullscopehemo2$Infect[PolyFullscopehemo2$cells.larvae==0]<-0
PolyFullscopehemo3<-subset(PolyFullscopehemo2, select = -c(cells.larvae))# drop cells.larvae col
 
Poly_binomial<-rbind(PolyFullscopehemo3,RelA_binaryb_2) #combine for the Poly BINOMIAL ONLY DF
Poly_binomial$Symbiont<-"Poly" #create symbiont col

Poly_binomial$Infect<-as.factor(Poly_binomial$Infect)
  Poly_binomial$count.type<-as.factor(Poly_binomial$count.type)
  
#make DF for Poly cell densities for COUNTS (not binomial) (ALL =Poly)
#ALLcast_9000_cast2b  ALL df only larva with 4 genera, add this to the scopecounts stuff: ALLFullscopehemo2
  ALLcast_9000_cast2c<-ALLcast_9000_cast2b
  ALLcast_9000_cast2c<- ALLcast_9000_cast2c %>% mutate(sumrow= C1 + D1 + F1 + G3) #create sum for larva
names(ALLcast_9000_cast2c)[names(ALLcast_9000_cast2c)=="sumrow"] <- "cells.larvae" #rename col
ALLcast_9000_cast2c$count.type<-"ddPCR"
ALLcast_9000_cast2cAvars<-c("Temp","Day","cells.larvae","Pot","count.type") #select cols to keep
ALLcast_9000_cast3<-ALLcast_9000_cast2c[ALLcast_9000_cast2cAvars] # new df
  
  PolyFullscopehemo4<-subset(PolyFullscopehemo2, select = -c(Infect)) #prep scope hemo df (with cells.lar still there)
  
Poly_forCounts<-rbind(PolyFullscopehemo4,ALLcast_9000_cast3) # combine scope/hemo with ddPCR for Poly
Poly_forCounts<-na.omit(Poly_forCounts) 
```
 
Create binomial for monocultures
```{r}                
BinaryInfect<-Monoculture  # make new df for binary infection
  BinaryInfect$Infect[BinaryInfect$cells.larvae_counts_unlog>0]<-1  #make new col for infect or not 1 for infect, 0 not.
  BinaryInfect$Infect[BinaryInfect$cells.larvae_counts_unlog==0]<-0
 BinaryInfect$Infect<-as.character(BinaryInfect$Infect)
  BinaryInfect$Infect<-as.numeric(BinaryInfect$Infect)

Binaryvars<-c("Temp","Day","Infect","Pot","count.type","Symbiont") #keep vars you need
BinaryInfect<-BinaryInfect[Binaryvars]
 
#combine Mono with Poly infect or not
BinaryInfect<-rbind(BinaryInfect, Poly_binomial) #add the Polys for JUST this assay in here (calc above chunk)
 
 #rename Pot interaction as a code: Pot_Temp
 BinaryInfect$PotCode<-paste0(BinaryInfect$Temp, BinaryInfect$Pot,BinaryInfect$Symbiont )
 BinaryInfect$PotCode<-as.factor(BinaryInfect$PotCode) #make factor
```
Binomial Models
```{r}   
#Full model including all clades/temp/time: 
BinaryInfect<-na.omit(BinaryInfect) #remove nas
BinaryInfect$Infect<-as.factor(BinaryInfect$Infect)

#BinaryInfect14<-BinaryInfect #to include day 14

#Full model remove day 14 at 31   
BinaryInfect$daytemp<-paste0(BinaryInfect$Day, BinaryInfect$Temp )  #create tag
BinaryInfect<-subset(BinaryInfect, daytemp !=1431)       #remove 1431
  
 Binary_mod<-glmer(Infect~Symbiont*Temp*Day+(1|PotCode), family="binomial", BinaryInfect)
  Anova(Binary_mod)
  summary(Binary_mod)
  emm<-emmeans(Binary_mod,  ~ Symbiont|Temp*Day)
    pairs(emm)
    cld(emm) 
  emm<-emmeans(Binary_mod,  ~ Symbiont)
      cld(emm)
  

#subset 27 and 30 ONLY
BinaryInfect_27and30<-subset(BinaryInfect, Temp=="27"|Temp=="30")
BinaryInfect_27and30_mod<-glmer(Infect~Symbiont*Temp*Day+(1|PotCode), family="binomial", BinaryInfect_27and30) #
  Anova(BinaryInfect_27and30_mod)
dispersion_glmer(BinaryInfect_27and30_mod) # .75

#subset D3 and 7 ONLY
BinaryInfect_D3andD7<-subset(BinaryInfect, Day=="3"|Day=="7")
BinaryInfect_D3andD7_mod<-glmer(Infect~Symbiont*Temp*Day+(1|PotCode), family="binomial", BinaryInfect_D3andD7) #
  Anova(BinaryInfect_D3andD7_mod)
dispersion_glmer(BinaryInfect_D3andD7_mod) # no overdispersion  1.01

```

Subset by temp for plots
```{r}       
  Binary_27<-subset(BinaryInfect, Temp=="27")
  Binary_27$Infect<-as.numeric(as.character(Binary_27$Infect)) #change back to numeric for plots
  Binary_30<-subset(BinaryInfect, Temp=="30")
  Binary_30$Infect<-as.numeric(as.character(Binary_30$Infect)) #change back to numeric for plots

  Binary_31<-subset(BinaryInfect, Temp=="31")
  Binary_31$Infect<-as.numeric(as.character(Binary_31$Infect)) #change back to numeric for plots

 # subset to keep C1 and G at 31 d 14 for plot
#df BinaryInfect14

Binary_31_31CD13<-subset(BinaryInfect14, Temp=="31")
Binary_31_31CD13$Infect<-as.numeric(as.character(Binary_31_31CD13$Infect)) #change back to numeric for plots
```

Plots:  
27C
```{r}           
Binary_27_mean <- ddply(Binary_27, c("Symbiont","Day"), summarise, #summarize cell counts
                 N    = length(Infect[!is.na(Infect)]), #calculate the length of the data frame,  excluding NA’s *this part is important*
                 mean = mean(Infect, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(Infect, na.rm=TRUE), #calculate standard deviation 
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(Infect, na.rm=TRUE)) #calculate max, could also calculate min () if desired  

Binary_27_mean #display table 
 #change Day back to Numeric from Factor, reapply the actual numeric dates
Binary_27_mean$Day.num<-as.numeric(Binary_27_mean$Day)
Binary_27_mean$Day.num[Binary_27_mean$Day.num == 2] =7
Binary_27_mean$Day.num[Binary_27_mean$Day.num == 3] =14
Binary_27_mean$Day.num[Binary_27_mean$Day.num == 1] =3
#plot
Binary_27_mean_plot<-ggplot(data=Binary_27_mean, aes(x=Day.num, y=mean, group = Symbiont, color=Symbiont)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se), 
                width=0.1, show.legend = T)+
  geom_point(aes(color=Symbiont), size=4, show.legend = T)+ 
  geom_line(aes(color=Symbiont),linetype="dotted")+
  scale_color_manual(values=c('#EEA236FF','#46B8DAFF','#D43F3AFF','#5CB85CFF',"black"))+
   geom_point(shape = 1,size = 4,colour = "black")+
  xlab("") + #Label the X Axis
  ylim(0,1) + #set Y limits 
       scale_x_continuous(breaks=seq(0, 14, 2), limits =c(0,14))+
   #scale_y_log10()+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("Percent of larvae"))) + 
 ggtitle("27C")+ 
  theme(plot.title = element_text(size=20, face = "italic", hjust=0.5));Binary_27_mean_plot
```
30C
```{r}        
Binary_30_mean <- ddply(Binary_30, c("Symbiont","Day"), summarise, #summarize cell counts
                 N    = length(Infect[!is.na(Infect)]), #calculate the length of the data frame,  excluding NA’s *this part is important*
                 mean = mean(Infect, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(Infect, na.rm=TRUE), #calculate standard deviation 
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(Infect, na.rm=TRUE)) #calculate max, could also calculate min () if desired  

Binary_30_mean #display table 
 #change Day back to Numeric from Factor, reapply the actual numeric dates
Binary_30_mean$Day.num<-as.numeric(Binary_30_mean$Day)
Binary_30_mean$Day.num[Binary_30_mean$Day.num == 2] =7
Binary_30_mean$Day.num[Binary_30_mean$Day.num == 3] =14
Binary_30_mean$Day.num[Binary_30_mean$Day.num == 1] =3
#plot
Binary_30_mean_plot<-ggplot(data=Binary_30_mean, aes(x=Day.num, y=mean, group = Symbiont, color=Symbiont)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Symbiont), size=4, show.legend = T)+ 
  geom_line(aes(color=Symbiont),linetype="dotted")+
  scale_color_manual(values=c('#EEA236FF','#46B8DAFF','#D43F3AFF','#5CB85CFF',"black"))+
   geom_point(shape = 1,size = 4,colour = "black")+
  xlab("") + #Label the X Axis
  ylim(0,1) + #set Y limits 
       scale_x_continuous(breaks=seq(0, 14, 2), limits =c(0,14))+
   #scale_y_log10()+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(""))) + 
 ggtitle("30C")+ 
  theme(plot.title = element_text(size=20, face = "italic", hjust=0.5));Binary_30_mean_plot
```
31C
```{r}         
Binary_31_mean <- ddply(Binary_31, c("Symbiont","Day"), summarise, #summarize cell counts
                 N    = length(Infect[!is.na(Infect)]), #calculate the length of the data frame,  excluding NA’s *this part is important*
                 mean = mean(Infect, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(Infect, na.rm=TRUE), #calculate standard deviation 
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(Infect, na.rm=TRUE)) #calculate max, could also calculate min () if desired  
 
Binary_31_mean #display table

#remove F1 day 14, n=3
Binary_31_mean<-Binary_31_mean[!(Binary_31_mean$N=="3"),]


 #change Day back to Numeric from Factor, reapply the actual numeric dates
Binary_31_mean$Day.num<-as.numeric(Binary_31_mean$Day)
Binary_31_mean$Day.num[Binary_31_mean$Day.num == 2] =7
Binary_31_mean$Day.num[Binary_31_mean$Day.num == 3] =14
Binary_31_mean$Day.num[Binary_31_mean$Day.num == 1] =3
#plot
Binary_31_mean_plot<-ggplot(data=Binary_31_mean, aes(x=Day.num, y=mean, group = Symbiont, color=Symbiont)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Symbiont), size=4, show.legend = T)+ 
  geom_line(aes(color=Symbiont),linetype="dotted")+
  scale_color_manual(values=c('#EEA236FF','#46B8DAFF','#D43F3AFF','#5CB85CFF',"black"))+
   geom_point(shape = 1,size = 4,colour = "black")+
  xlab("") + #Label the X Axis
  ylim(0,1) + #set Y limits 
       scale_x_continuous(breaks=seq(0, 14, 2), limits =c(0,14))+
   #scale_y_log10()+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(""))) + 
 ggtitle("31C")+ 
  theme(plot.title = element_text(size=20, face = "italic", hjust=0.5));Binary_31_mean_plot


##### do 31c with all that ampted. Binary_31_31CD13
Binary_31_31CD13_mean <- ddply(Binary_31_31CD13, c("Symbiont","Day"), summarise, #summarize cell counts
                 N    = length(Infect[!is.na(Infect)]), #calculate the length of the data frame,  excluding NA’s *this part is important*
                 mean = mean(Infect, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(Infect, na.rm=TRUE), #calculate standard deviation 
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(Infect, na.rm=TRUE)) #calculate max, could also calculate min () if desired  
 
Binary_31_31CD13_mean #display table

#remove F1 day 14, n=3, do you want to make 3 the cut off
#Binary_31_31CD13_mean<-Binary_31_31CD13_mean[!(Binary_31_31CD13_mean$N=="3"),]


 #change Day back to Numeric from Factor, reapply the actual numeric dates
Binary_31_31CD13_mean$Day.num<-as.numeric(Binary_31_31CD13_mean$Day)
Binary_31_31CD13_mean$Day.num[Binary_31_31CD13_mean$Day.num == 2] =7
Binary_31_31CD13_mean$Day.num[Binary_31_31CD13_mean$Day.num == 3] =14
Binary_31_31CD13_mean$Day.num[Binary_31_31CD13_mean$Day.num == 1] =3
#plot
Binary_31_31CD13_mean_plot<-ggplot(data=Binary_31_31CD13_mean, aes(x=Day.num, y=mean, group = Symbiont, color=Symbiont)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Symbiont), size=4, show.legend = T)+ 
  geom_line(aes(color=Symbiont),linetype="dotted")+
  scale_color_manual(values=c('#EEA236FF','#46B8DAFF','#D43F3AFF','#5CB85CFF',"black"))+
   geom_point(shape = 1,size = 4,colour = "black")+
  xlab("") + #Label the X Axis
  ylim(0,1) + #set Y limits 
       scale_x_continuous(breaks=seq(0, 14, 2), limits =c(0,14))+
   #scale_y_log10()+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(""))) + 
 ggtitle("31C")+ 
  theme(plot.title = element_text(size=20, face = "italic", hjust=0.5));Binary_31_31CD13_mean_plot

```

All plots together, Fig2A 
```{r}  
#log scale axis only  
Binary_27_mean_plot<-Binary_27_mean_plot+ theme(legend.position = "none") #remove legend
Binary_30_mean_plot<-Binary_30_mean_plot+ theme(legend.position = "none") #remove legend
Binary_31_31CD13_mean_plot<-Binary_31_31CD13_mean_plot+ theme(legend.position = "none") #remove legend
grid.arrange(Binary_27_mean_plot, Binary_30_mean_plot, Binary_31_31CD13_mean_plot, nrow = 1)
```

# Binomial: Monoculture vs Polyculture by clade: Binomial (pink and blue plots)   
all amplifications= ALLcast_9000_cast2a 
Plots and comparison models singe v multi 
Did larvae with single clades infect more or less than larvae offered multiple clades:
```{r}      
#stats    
#df for poly:RelA_binaryb, df for mono: BinaryInfect
RelA_binaryb$PotCode<-paste0(RelA_binaryb$Temp, RelA_binaryb$Pot) #add PotCode

# Set up to run models by GENUS ddPCR
# C1 in polyculture
RelA_binarybb_C1<-RelA_binaryb[,c("Temp","Day","PotCode","C1")] #keep only cols you need
RelA_binarybb_C1$infectType<-"Multi"
names(RelA_binarybb_C1)[names(RelA_binarybb_C1) == "C1"] <- "Infect"   #change C1 col name to "infect"
RelA_binarybb_C1<-na.omit(RelA_binarybb_C1) #remove NAS
RelA_binarybb_C1$Symbiont<-"C1"

# D1 in polyculture
RelA_binarybb_D1<-RelA_binaryb[,c("Temp","Day","PotCode","D1")] #keep only cols you need
RelA_binarybb_D1$infectType<-"Multi"
names(RelA_binarybb_D1)[names(RelA_binarybb_D1) == "D1"] <- "Infect"   #change C1 col name to "infect"
RelA_binarybb_D1<-na.omit(RelA_binarybb_D1) #remove NAS
RelA_binarybb_D1$Symbiont<-"D1"

# F1 in polyculture
RelA_binarybb_F1<-RelA_binaryb[,c("Temp","Day","PotCode","F1")] #keep only cols you need
RelA_binarybb_F1$infectType<-"Multi"
names(RelA_binarybb_F1)[names(RelA_binarybb_F1) == "F1"] <- "Infect"   #change C1 col name to "infect"
RelA_binarybb_F1<-na.omit(RelA_binarybb_F1) #remove NAS
RelA_binarybb_F1$Symbiont<-"F1"

# G3 in polyculture
RelA_binarybb_G3<-RelA_binaryb[,c("Temp","Day","PotCode","G3")] #keep only cols you need
RelA_binarybb_G3$infectType<-"Multi"
names(RelA_binarybb_G3)[names(RelA_binarybb_G3) == "G3"] <- "Infect"   #change C1 col name to "infect"
RelA_binarybb_G3<-na.omit(RelA_binarybb_G3) #remove NAS
RelA_binarybb_G3$Symbiont<-"G3"

#Monoculture by clade (monoculture df binary already, new col for infect type)
BinaryInfect_C1<-subset(BinaryInfect, Symbiont=="C1")
BinaryInfect_D1<-subset(BinaryInfect, Symbiont=="D1")
BinaryInfect_F1<-subset(BinaryInfect, Symbiont=="F1")
BinaryInfect_G3<-subset(BinaryInfect, Symbiont=="G3")

binaryb_C1_binaryb<-BinaryInfect_C1[,c("Temp","Day","PotCode","Symbiont","Infect")]
binaryb_C1_binaryb$infectType<-"Single"
binaryb_D1_binaryb<-BinaryInfect_D1[,c("Temp","Day","PotCode","Symbiont","Infect")]
binaryb_D1_binaryb$infectType<-"Single"
binaryb_F1_binaryb<-BinaryInfect_F1[,c("Temp","Day","PotCode","Symbiont","Infect")]
binaryb_F1_binaryb$infectType<-"Single"
binaryb_G3_binaryb<-BinaryInfect_G3[,c("Temp","Day","PotCode","Symbiont","Infect")]
binaryb_G3_binaryb$infectType<-"Single"

#Individual Infections of Polyculture larvae: only use this data to compare to SINGLE infections. PotCode is coded to keep separate single and multi pots
#Set up dfs for plots  
   
C1_binaryb_SinMul<-rbind(RelA_binarybb_C1, binaryb_C1_binaryb)
C1_binaryb_SinMul$Infect<-as.factor(C1_binaryb_SinMul$Infect)
C1_binaryb_SinMul$Symbiont<-as.factor(C1_binaryb_SinMul$Symbiont)
C1_binaryb_SinMul$infectType<-as.factor(C1_binaryb_SinMul$infectType)
C1_binaryb_SinMul$PotCode<-as.factor(C1_binaryb_SinMul$PotCode)

D1_binaryb_SinMul<-rbind(RelA_binarybb_D1, binaryb_D1_binaryb)
D1_binaryb_SinMul$Infect<-as.factor(D1_binaryb_SinMul$Infect)
D1_binaryb_SinMul$Symbiont<-as.factor(D1_binaryb_SinMul$Symbiont)
D1_binaryb_SinMul$infectType<-as.factor(D1_binaryb_SinMul$infectType)
D1_binaryb_SinMul$PotCode<-as.factor(D1_binaryb_SinMul$PotCode)

F1_binaryb_SinMul<-rbind(RelA_binarybb_F1, binaryb_F1_binaryb)
F1_binaryb_SinMul$Infect<-as.factor(F1_binaryb_SinMul$Infect)
F1_binaryb_SinMul$Symbiont<-as.factor(F1_binaryb_SinMul$Symbiont)
F1_binaryb_SinMul$infectType<-as.factor(F1_binaryb_SinMul$infectType)
F1_binaryb_SinMul$PotCode<-as.factor(F1_binaryb_SinMul$PotCode)

G3_binaryb_SinMul<-rbind(RelA_binarybb_G3, binaryb_G3_binaryb)
G3_binaryb_SinMul$Infect<-as.factor(G3_binaryb_SinMul$Infect)
G3_binaryb_SinMul$Symbiont<-as.factor(G3_binaryb_SinMul$Symbiont)
G3_binaryb_SinMul$infectType<-as.factor(G3_binaryb_SinMul$infectType)
G3_binaryb_SinMul$PotCode<-as.factor(G3_binaryb_SinMul$PotCode)

```
C1 no-choice vs 4-way
```{r}      
#model SINGLE vs MULTI 
C1_binaryb_SinMul_mod<-glmer(Infect~Temp*infectType*Day+(1|PotCode), family="binomial", C1_binaryb_SinMul) 
Anova(C1_binaryb_SinMul_mod)   #variance-covariance issues
#dispersion_glmer(C1_binaryb_SinMul_mod) # no overdispersion 1.00 
emm<-emmeans(C1_binaryb_SinMul_mod,  ~ infectType*Temp*Day, adjust="Tukey")
cld(emm)

#mean
C1_binaryb_SinMul$Infect<-as.character(C1_binaryb_SinMul$Infect) #change infect back to a number for mean
C1_binaryb_SinMul$Infect<-as.numeric(C1_binaryb_SinMul$Infect)

C1_binaryb_SinMul_mean <- ddply(C1_binaryb_SinMul, c("Temp", "infectType","Day"), summarise, #summarize cell counts
                 N    = length(Infect[!is.na(Infect)]), #calculate the length of the data frame,  excluding NA’s *this part is important*
                 mean = mean(Infect, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(Infect, na.rm=TRUE), #calculate standard deviation 
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(Infect, na.rm=TRUE)) #calculate max, could also calculate min () if desired  

C1_binaryb_SinMul_mean #display table 
C1_binaryb_SinMul_mean<-na.omit(C1_binaryb_SinMul_mean)

#change Day back to Numeric from Factor, reapply the actual numeric dates
C1_binaryb_SinMul_mean$Day<-as.numeric(C1_binaryb_SinMul_mean$Day)
C1_binaryb_SinMul_mean$Day[C1_binaryb_SinMul_mean$Day == 2] =7
C1_binaryb_SinMul_mean$Day[C1_binaryb_SinMul_mean$Day == 3] =14
C1_binaryb_SinMul_mean$Day[C1_binaryb_SinMul_mean$Day == 1] =3

#separate by Temp
C1_binaryb_SinMul_mean_27<-subset(C1_binaryb_SinMul_mean, Temp=="27")
C1_binaryb_SinMul_mean_30<-subset(C1_binaryb_SinMul_mean, Temp=="30")
C1_binaryb_SinMul_mean_31<-subset(C1_binaryb_SinMul_mean, Temp=="31")
 C1_binaryb_SinMul_mean_31<-subset(C1_binaryb_SinMul_mean_31, Day=="3" |Day=="7")

#plots
#27

C1_binaryb_SinMul_plot_27<-ggplot(data=C1_binaryb_SinMul_mean_27, aes(x=Day, y=mean, group=infectType, color=infectType)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.4, show.legend = T)+
  geom_point(aes(color=infectType), size=4.5, show.legend = T)+
     geom_point(shape = 1,size = 5,colour = "black")+
  geom_line(aes(color=infectType, linetype=infectType))+
    scale_linetype_manual(values=c("solid", "dotted"))+
  scale_color_manual(values=c("deeppink3", "turquoise3"))+
  xlab("Days") + #Label the X Axis
    ylim(0,1.2)+
        scale_x_continuous(breaks=seq(0, 14, 2), limits =c(0,15))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("% larvae infected"))) +
  ggtitle("27C C1")+
  theme(plot.title = element_text(size=20, face = "italic"));C1_binaryb_SinMul_plot_27

#30

C1_binaryb_SinMul_plot_30<-ggplot(data=C1_binaryb_SinMul_mean_30, aes(x=Day, y=mean, group=infectType, color=infectType)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.4, show.legend = T)+
  geom_point(aes(color=infectType), size=4.5, show.legend = T)+
  geom_line(aes(color=infectType, linetype=infectType))+
       geom_point(shape = 1,size = 5,colour = "black")+
      scale_linetype_manual(values=c("solid", "dotted"))+
  scale_color_manual(values=c("deeppink3", "turquoise3"))+
  xlab("Days") + #Label the X Axis
  ylim(0,1.2)+
          scale_x_continuous(breaks=seq(0, 14, 2), limits =c(0,15))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("% larvae infected"))) +
  ggtitle("30C C1")+
  theme(plot.title = element_text(size=20, face = "italic"));C1_binaryb_SinMul_plot_30

#31

C1_binaryb_SinMul_plot_31<-ggplot(data=C1_binaryb_SinMul_mean_31, aes(x=Day, y=mean, group=infectType, color=infectType)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.4, show.legend = T)+
  geom_point(aes(color=infectType), size=4.5, show.legend = T)+
         geom_point(shape = 1,size = 5,colour = "black")+
  geom_line(aes(color=infectType, linetype=infectType))+
        scale_linetype_manual(values=c("solid", "dotted"))+

  scale_color_manual(values=c("deeppink3", "turquoise3"))+
  xlab("Days") + #Label the X Axis
  ylim(0,1.2)+
          scale_x_continuous(breaks=seq(0, 14, 2), limits =c(0,15))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("% larvae infected"))) +
  ggtitle("31C C1")+
  theme(plot.title = element_text(size=20, face = "italic"));C1_binaryb_SinMul_plot_31

#plot together
C1_binaryb_SinMul_plot_27<-C1_binaryb_SinMul_plot_27+ theme(legend.position = "none") #remove legend
C1_binaryb_SinMul_plot_30<-C1_binaryb_SinMul_plot_30+ theme(legend.position = "none") #remove legend
C1_binaryb_SinMul_plot_31<-C1_binaryb_SinMul_plot_31+ theme(legend.position = "none") #remove legend

grid.arrange(C1_binaryb_SinMul_plot_27, C1_binaryb_SinMul_plot_30, C1_binaryb_SinMul_plot_31, nrow = 1)
```
D1 no-choice vs 4-way
```{r}  
 
#model 
D1_binaryb_SinMul_no14<-subset(D1_binaryb_SinMul, Day=="3"|Day=="7")
D1_binaryb_SinMul_mod<-glmer(Infect~Temp*infectType*Day+(1|PotCode), family="binomial", D1_binaryb_SinMul_no14) 
Anova(D1_binaryb_SinMul_mod)
dispersion_glmer(D1_binaryb_SinMul_mod) # no overdispersion .91
emm<-emmeans(D1_binaryb_SinMul_mod,  ~ infectType*Temp*Day, adjust="Tukey")
cld(emm)

#all days. we dont have data for day 14 31. but that shoudl be ok. Why did oyu only do day 3 and 7 above?
D1_binaryb_SinMul_mod<-glmer(Infect~Temp*infectType*Day+(1|PotCode), family="binomial", D1_binaryb_SinMul) 
Anova(D1_binaryb_SinMul_mod)
dispersion_glmer(D1_binaryb_SinMul_mod) # no overdispersion .91
emm<-emmeans(D1_binaryb_SinMul_mod,  ~ infectType, adjust="Tukey")
cld(emm)

#mean
D1_binaryb_SinMul$Infect<-as.character(D1_binaryb_SinMul$Infect) #change infect back to a number for mean
D1_binaryb_SinMul$Infect<-as.numeric(D1_binaryb_SinMul$Infect)

D1_binaryb_SinMul_mean <- ddply(D1_binaryb_SinMul, c("Temp", "infectType","Day"), summarise, #summarize cell counts
                 N    = length(Infect[!is.na(Infect)]), #calculate the length of the data frame,  excluding NA’s *this part is important*
                 mean = mean(Infect, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(Infect, na.rm=TRUE), #calculate standard deviation 
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(Infect, na.rm=TRUE)) #calculate max, could also calculate min () if desired  

D1_binaryb_SinMul_mean #display table  
D1_binaryb_SinMul_mean<-na.omit(D1_binaryb_SinMul_mean)

#change Day back to Numeric from Factor, reapply the actual numeric dates
D1_binaryb_SinMul_mean$Day<-as.numeric(D1_binaryb_SinMul_mean$Day)
D1_binaryb_SinMul_mean$Day[D1_binaryb_SinMul_mean$Day == 2] =7
D1_binaryb_SinMul_mean$Day[D1_binaryb_SinMul_mean$Day == 3] =14
D1_binaryb_SinMul_mean$Day[D1_binaryb_SinMul_mean$Day == 1] =3

#separate by Temp
D1_binaryb_SinMul_mean_27<-subset(D1_binaryb_SinMul_mean, Temp=="27")
D1_binaryb_SinMul_mean_30<-subset(D1_binaryb_SinMul_mean, Temp=="30")
D1_binaryb_SinMul_mean_31<-subset(D1_binaryb_SinMul_mean, Temp=="31")
D1_binaryb_SinMul_mean_31<-na.omit(D1_binaryb_SinMul_mean_31)



#plot
#27
D1_binaryb_SinMul_plot_27<-ggplot(data=D1_binaryb_SinMul_mean_27, aes(x=Day, y=mean, group=infectType, color=infectType)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.4, show.legend = T)+
  geom_point(aes(color=infectType), size=4.5, show.legend = T)+
         geom_point(shape = 1,size = 5,colour = "black")+
  geom_line(aes(color=infectType, linetype=infectType))+
          scale_linetype_manual(values=c("solid", "dotted"))+
  scale_color_manual(values=c("deeppink3", "turquoise3"))+
         geom_point(shape = 1,size = 5,colour = "black")+
  xlab("Days") + #Label the X Axis
    ylim(0,1.2)+
          scale_x_continuous(breaks=seq(0, 14, 2), limits =c(0,15))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("% larvae infected"))) +
  ggtitle("27C D1")+
  theme(plot.title = element_text(size=20, face = "italic"));D1_binaryb_SinMul_plot_27

#30
D1_binaryb_SinMul_plot_30<-ggplot(data=D1_binaryb_SinMul_mean_30, aes(x=Day, y=mean, group=infectType, color=infectType)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.4, show.legend = T)+
  geom_point(aes(color=infectType), size=4.5, show.legend = T)+
         geom_point(shape = 1,size = 5,colour = "black")+
  geom_line(aes(color=infectType, linetype=infectType))+
         geom_point(shape = 1,size = 5,colour = "black")+
          scale_linetype_manual(values=c("solid", "dotted"))+
  scale_color_manual(values=c("deeppink3", "turquoise3"))+
  xlab("Days") + #Label the X Axis
    ylim(0,1.2)+
          scale_x_continuous(breaks=seq(0, 14, 2), limits =c(0,15))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("% larvae infected"))) +
  ggtitle("30C D1")+
  theme(plot.title = element_text(size=20, face = "italic"));D1_binaryb_SinMul_plot_30

#31
D1_binaryb_SinMul_plot_31<-ggplot(data=D1_binaryb_SinMul_mean_31, aes(x=Day, y=mean, group=infectType, color=infectType)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.4, show.legend = T)+
  geom_point(aes(color=infectType), size=4.5, show.legend = T)+
  geom_line(aes(color=infectType, linetype=infectType))+
          scale_linetype_manual(values=c("solid", "dotted"))+
         geom_point(shape = 1,size = 5,colour = "black")+
  scale_color_manual(values=c("deeppink3", "turquoise3"))+
  xlab("Days") + #Label the X Axis
    ylim(0,1.2)+
          scale_x_continuous(breaks=seq(0, 14, 2), limits =c(0,15))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("% larvae infected"))) +
  ggtitle("31C D1")+
  theme(plot.title = element_text(size=20, face = "italic"));D1_binaryb_SinMul_plot_31

#plot together
D1_binaryb_SinMul_plot_27<-D1_binaryb_SinMul_plot_27+ theme(legend.position = "none") #remove legend
D1_binaryb_SinMul_plot_30<-D1_binaryb_SinMul_plot_30+ theme(legend.position = "none") #remove legend
D1_binaryb_SinMul_plot_31<-D1_binaryb_SinMul_plot_31+ theme(legend.position = "none") #remove legend

grid.arrange(D1_binaryb_SinMul_plot_27, D1_binaryb_SinMul_plot_30, D1_binaryb_SinMul_plot_31, nrow = 1)
```
F1 no-choice vs 4-way
```{r}  
#F1 
F1_binaryb_SinMul_mod<-glmer(Infect~Temp*infectType*Day+(1|PotCode), family="binomial", F1_binaryb_SinMul) 
Anova(F1_binaryb_SinMul_mod) 
dispersion_glmer(F1_binaryb_SinMul_mod) # no overdispersion 1.11
emm<-emmeans(F1_binaryb_SinMul_mod,  ~ infectType*Temp*Day, adjust="Tukey")
cld(emm)
#mean
F1_binaryb_SinMul$Infect<-as.character(F1_binaryb_SinMul$Infect) #change infect back to a number for mean
F1_binaryb_SinMul$Infect<-as.numeric(F1_binaryb_SinMul$Infect)

F1_binaryb_SinMul_mean <- ddply(F1_binaryb_SinMul, c("Temp", "infectType","Day"), summarise, #summarize cell counts
                 N    = length(Infect[!is.na(Infect)]), #calculate the length of the data frame,  excluding NA’s *this part is important*
                 mean = mean(Infect, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(Infect, na.rm=TRUE), #calculate standard deviation 
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(Infect, na.rm=TRUE)) #calculate max, could also calculate min () if desired  

F1_binaryb_SinMul_mean #display table 
F1_binaryb_SinMul_mean<-na.omit(F1_binaryb_SinMul_mean)

#change Day back to Numeric from Factor, reapply the actual numeric dates
F1_binaryb_SinMul_mean$Day<-as.numeric(F1_binaryb_SinMul_mean$Day)
F1_binaryb_SinMul_mean$Day[F1_binaryb_SinMul_mean$Day == 2] =7
F1_binaryb_SinMul_mean$Day[F1_binaryb_SinMul_mean$Day == 3] =14
F1_binaryb_SinMul_mean$Day[F1_binaryb_SinMul_mean$Day == 1] =3

#separate by Temp
F1_binaryb_SinMul_mean_27<-subset(F1_binaryb_SinMul_mean, Temp=="27")
F1_binaryb_SinMul_mean_30<-subset(F1_binaryb_SinMul_mean, Temp=="30")
F1_binaryb_SinMul_mean_31<-subset(F1_binaryb_SinMul_mean, Temp=="31")
 F1_binaryb_SinMul_mean_31<-subset(F1_binaryb_SinMul_mean_31, Day=="3" |Day=="7")

#plot
#27
F1_binaryb_SinMul_plot_27<-ggplot(data=F1_binaryb_SinMul_mean_27, aes(x=Day, y=mean, group=infectType, color=infectType)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.4, show.legend = T)+
  geom_point(aes(color=infectType), size=4.5, show.legend = T)+
  geom_line(aes(color=infectType, linetype=infectType))+
         geom_point(shape = 1,size = 5,colour = "black")+
          scale_linetype_manual(values=c("solid", "dotted"))+
  scale_color_manual(values=c("deeppink3", "turquoise3"))+
  xlab("Days") + #Label the X Axis
    ylim(0,1.2)+
          scale_x_continuous(breaks=seq(0, 14, 2), limits =c(0,15))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("% larvae infected"))) +
  ggtitle("27C F1")+
  theme(plot.title = element_text(size=20, face = "italic"));F1_binaryb_SinMul_plot_27

#30
F1_binaryb_SinMul_plot_30<-ggplot(data=F1_binaryb_SinMul_mean_30, aes(x=Day, y=mean, group=infectType, color=infectType)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.4, show.legend = T)+
  geom_point(aes(color=infectType), size=4.5, show.legend = T)+
  geom_line(aes(color=infectType, linetype=infectType))+
         geom_point(shape = 1,size = 5,colour = "black")+
          scale_linetype_manual(values=c("solid", "dotted"))+
  scale_color_manual(values=c("deeppink3", "turquoise3"))+
  xlab("Days") + #Label the X Axis
    ylim(0,1.2)+
          scale_x_continuous(breaks=seq(0, 14, 2), limits =c(0,15))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("% larvae infected"))) +
  ggtitle("230C F1")+
  theme(plot.title = element_text(size=20, face = "italic"));F1_binaryb_SinMul_plot_30

#31
F1_binaryb_SinMul_plot_31<-ggplot(data=F1_binaryb_SinMul_mean_31, aes(x=Day, y=mean, group=infectType, color=infectType)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.4, show.legend = T)+
  geom_point(aes(color=infectType), size=4.5, show.legend = T)+
         geom_point(shape = 1,size = 5,colour = "black")+
  geom_line(aes(color=infectType, linetype=infectType))+
          scale_linetype_manual(values=c("solid", "dotted"))+
  scale_color_manual(values=c("deeppink3", "turquoise3"))+
  xlab("Days") + #Label the X Axis
    ylim(0,1.2)+
          scale_x_continuous(breaks=seq(0, 14, 2), limits =c(0,15))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("% larvae infected"))) +
  ggtitle("31C F1")+
  theme(plot.title = element_text(size=20, face = "italic"));F1_binaryb_SinMul_plot_31

#plot together
F1_binaryb_SinMul_plot_27<-F1_binaryb_SinMul_plot_27+ theme(legend.position = "none") #remove legend
F1_binaryb_SinMul_plot_30<-F1_binaryb_SinMul_plot_30+ theme(legend.position = "none") #remove legend
F1_binaryb_SinMul_plot_31<-F1_binaryb_SinMul_plot_31+ theme(legend.position = "none") #remove legend

grid.arrange(F1_binaryb_SinMul_plot_27, F1_binaryb_SinMul_plot_30, F1_binaryb_SinMul_plot_31, nrow = 1)
```
G1 no-choice vs 4-way
```{r}
#G3  
G3_binaryb_SinMul_mod<-glmer(Infect~Temp*infectType*Day+(1|PotCode), family="binomial", G3_binaryb_SinMul) 
Anova(G3_binaryb_SinMul_mod)
dispersion_glmer(G3_binaryb_SinMul_mod) # .56 
emm<-emmeans(G3_binaryb_SinMul_mod,  ~ infectType*Temp*Day, adjust="Tukey")
cld(emm)
#mean
G3_binaryb_SinMul$Infect<-as.character(G3_binaryb_SinMul$Infect) #change infect back to a number for mean
G3_binaryb_SinMul$Infect<-as.numeric(G3_binaryb_SinMul$Infect)

G3_binaryb_SinMul_mean <- ddply(G3_binaryb_SinMul, c("Temp", "infectType","Day"), summarise, #summarize cell counts
                 N    = length(Infect[!is.na(Infect)]), #calculate the length of the data frame,  excluding NA’s *this part is important*
                 mean = mean(Infect, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(Infect, na.rm=TRUE), #calculate standard deviation 
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(Infect, na.rm=TRUE)) #calculate max, could also calculate min () if desired  
 
G3_binaryb_SinMul_mean #display table 
G3_binaryb_SinMul_mean<-na.omit(G3_binaryb_SinMul_mean)

#change Day back to Numeric from Factor, reapply the actual numeric dates
G3_binaryb_SinMul_mean$Day<-as.numeric(G3_binaryb_SinMul_mean$Day)
G3_binaryb_SinMul_mean$Day[G3_binaryb_SinMul_mean$Day == 2] =7
G3_binaryb_SinMul_mean$Day[G3_binaryb_SinMul_mean$Day == 3] =14
G3_binaryb_SinMul_mean$Day[G3_binaryb_SinMul_mean$Day == 1] =3
 
#separate by Temp
G3_binaryb_SinMul_mean_27<-subset(G3_binaryb_SinMul_mean, Temp=="27")
G3_binaryb_SinMul_mean_30<-subset(G3_binaryb_SinMul_mean, Temp=="30")
G3_binaryb_SinMul_mean_31<-subset(G3_binaryb_SinMul_mean, Temp=="31")
 G3_binaryb_SinMul_mean_31<-subset(G3_binaryb_SinMul_mean_31, Day=="3" |Day=="7")

#plot
#27
G3_binaryb_SinMul_plot_27<-ggplot(data=G3_binaryb_SinMul_mean_27, aes(x=Day, y=mean, group=infectType, color=infectType)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.4, show.legend = T)+
  geom_point(aes(color=infectType), size=4.5, show.legend = T)+
         geom_point(shape = 1,size = 5,colour = "black")+
  geom_line(aes(color=infectType, linetype=infectType))+
          scale_linetype_manual(values=c("solid", "dotted"))+
  scale_color_manual(values=c("deeppink3", "turquoise3"))+
  xlab("Days") + #Label the X Axis
    ylim(0,1.2)+
          scale_x_continuous(breaks=seq(0, 14, 2), limits =c(0,15))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("% larvae infected"))) +
  ggtitle("27C G3")+
  theme(plot.title = element_text(size=20, face = "italic"));G3_binaryb_SinMul_plot_27

#30 
G3_binaryb_SinMul_plot_30<-ggplot(data=G3_binaryb_SinMul_mean_30, aes(x=Day, y=mean, group=infectType, color=infectType)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.4, show.legend = T)+
  geom_point(aes(color=infectType), size=4.5, show.legend = T)+
         geom_point(shape = 1,size = 5,colour = "black")+
  geom_line(aes(color=infectType, linetype=infectType))+
          scale_linetype_manual(values=c("solid", "dotted"))+
  scale_color_manual(values=c("deeppink3", "turquoise3"))+
  xlab("Days") + #Label the X Axis
    ylim(0,1.2)+
          scale_x_continuous(breaks=seq(0, 14, 2), limits =c(0,15))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("% larvae infected"))) +
  ggtitle("30C G3")+
  theme(plot.title = element_text(size=20, face = "italic"));G3_binaryb_SinMul_plot_30

#31
G3_binaryb_SinMul_plot_31<-ggplot(data=G3_binaryb_SinMul_mean_31, aes(x=Day, y=mean, group=infectType, color=infectType)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.4, show.legend = T)+
  geom_point(aes(color=infectType), size=4.5, show.legend = T)+
         geom_point(shape = 1,size = 5,colour = "black")+
  geom_line(aes(color=infectType, linetype=infectType))+
          scale_linetype_manual(values=c("solid", "dotted"))+
  scale_color_manual(values=c("deeppink3", "turquoise3"))+
  xlab("Days") + #Label the X Axis
    ylim(0,1.2)+
          scale_x_continuous(breaks=seq(0, 14, 2), limits =c(0,15))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("% larvae infected"))) +
  ggtitle("31C G3")+
  theme(plot.title = element_text(size=20, face = "italic"));G3_binaryb_SinMul_plot_31

#plot together
G3_binaryb_SinMul_plot_27<-G3_binaryb_SinMul_plot_27+ theme(legend.position = "none") #remove legend
G3_binaryb_SinMul_plot_30<-G3_binaryb_SinMul_plot_30+ theme(legend.position = "none") #remove legend
G3_binaryb_SinMul_plot_31<-G3_binaryb_SinMul_plot_31+ theme(legend.position = "none") #remove legend

grid.arrange(G3_binaryb_SinMul_plot_27, G3_binaryb_SinMul_plot_30, G3_binaryb_SinMul_plot_31, nrow = 1)
```
Plot all 12
```{r}   
grid.arrange(C1_binaryb_SinMul_plot_27, C1_binaryb_SinMul_plot_30, C1_binaryb_SinMul_plot_31,D1_binaryb_SinMul_plot_27, D1_binaryb_SinMul_plot_30, D1_binaryb_SinMul_plot_31,F1_binaryb_SinMul_plot_27, F1_binaryb_SinMul_plot_30, F1_binaryb_SinMul_plot_31,G3_binaryb_SinMul_plot_27, G3_binaryb_SinMul_plot_30, G3_binaryb_SinMul_plot_31, nrow = 4)
 #wil remove legend in final plot for scale
``` 

# No-choice and 4-way choice infection: Cell Counts Models and Plots, Table 1
Model: `lmer(Infect~Symbiont*Temp*Day+(1|PotCode))` 
No-choice infections (histograms and full model) 
```{r}    
# poly=4-way
#set up the 4-way df for this specific model! use only 4-way larva with ddPCR for 4-way genera/larva + hemoscope
Poly_forCounts$cells.larvae_log<-log10(Poly_forCounts$cells.larvae+1) #log Polys
Poly_forCounts$Symbiont<-"Poly" #add symbiont col

#remove 0s
C1Full_no0<-subset(C1Full, cells.larvae>0)
D1Full_no0<-subset(D1Full, cells.larvae>0)
F1Full_no0<-subset(F1Full, cells.larvae>0)
G3Full_no0<-subset(G3Full, cells.larvae>0)

PolyFull_no0<-subset(Poly_forCounts, cells.larvae>0)
  PolyFull_no0$Symbiont<-as.factor(PolyFull_no0$Symbiont)
  PolyFull_no0$count.type<-as.factor(PolyFull_no0$count.type)

hist(C1Full_no0$cells.larvae_log) # normal
hist(D1Full_no0$cells.larvae_log) # normal
hist(F1Full_no0$cells.larvae_log) # normal
hist(G3Full_no0$cells.larvae_log) # normal
hist(PolyFull_no0$cells.larvae_log) # normal

Poly_Mono<-rbind(C1Full_no0,D1Full_no0,F1Full_no0,G3Full_no0) #combine mono df
Poly_Mono<-subset(Poly_Mono, select = -c( cells.larvae) ) #get rid of original cells.larvae, keep new counts
names(Poly_Mono)[names(Poly_Mono)=="cells.larvae_counts_unlog"] <- "cells.larvae" #rename the new counts cells.larvae for consistency 
Poly_Mono$count.type<-as.factor(Poly_Mono$count.type)

CellCounts_no0<-rbind(Poly_Mono,PolyFull_no0)  #use this for cell densities
hist(CellCounts_no0$cells.larvae_log) # normal 

#rename Pot interaction as a code: Pot_Temp
 CellCounts_no0$PotCode<-paste0(CellCounts_no0$Temp, CellCounts_no0$Pot,CellCounts_no0$Symbiont )
 CellCounts_no0$PotCode<-as.factor(CellCounts_no0$PotCode) #make factor
 
#Full model    
CellCounts_no0$daytemp<-paste0(CellCounts_no0$Day, CellCounts_no0$Temp )  #create tag
CellCounts_no0_NOD1431C<-subset(CellCounts_no0, daytemp !=1431)       #remove 1431

## lmer  symbionts*days*temp
Counts_no0_all_mod_noD1431<-lmer(cells.larvae_log~Symbiont*Day*Temp+(1|PotCode), CellCounts_no0_NOD1431C)
anova(Counts_no0_all_mod_noD1431) 
qqPlot(residuals(Counts_no0_all_mod_noD1431))   # good
  emm<-emmeans(Counts_no0_all_mod_noD1431,  ~ Symbiont|Temp *Day, adjust="Tukey")
    cld(emm)
    pairs(emm)
  emm<-emmeans(Counts_no0_all_mod_noD1431,  ~ Temp*Day|Symbiont , adjust="Tukey")
    cld(emm)
    pairs(emm)
  emm<-emmeans(Counts_no0_all_mod_noD1431,  ~ Symbiont*Day|Temp , adjust="Tukey")
    cld(emm)
    pairs(emm)

CellCounts_no0_NOD1431C_mean <- ddply(CellCounts_no0_NOD1431C, c("Day", "Symbiont","Temp"), summarise, #summarize cell counts
                  N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame,  excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation 
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE)) #calculate max, could also calculate min () if desired  
 
CellCounts_no0_NOD1431C_mean #display

# make means with D14 31C  CellCounts_no0
CellCounts_no0_mean <- ddply(CellCounts_no0, c("Day", "Symbiont","Temp"), summarise, #summarize cell counts
                  N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame,  excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation 
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE)) #calculate max, could also calculate min () if desired  
 
CellCounts_no0_mean #display
```
Plots By temp
27C
```{r}       
Poly_no0_27<-subset(CellCounts_no0_NOD1431C, Temp=="27")

Poly_no0_27_mean <- ddply(Poly_no0_27, c("Day", "Symbiont"), summarise, #summarize cell counts
                  N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame,  excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation 
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE)) #calculate max, could also calculate min () if desired  
 
Poly_no0_27_mean #display table

#change Day back to Numeric from Factor, reapply the actual numeric dates
Poly_no0_27_mean$Day.num<-as.numeric(Poly_no0_27_mean$Day)
Poly_no0_27_mean$Day.num[Poly_no0_27_mean$Day.num == 2] =7
Poly_no0_27_mean$Day.num[Poly_no0_27_mean$Day.num == 3] =14
Poly_no0_27_mean$Day.num[Poly_no0_27_mean$Day.num == 1] =3
 
#plot with yaxis log10, real data (not transformed)
Poly_no0_27_mean_plot<-ggplot(data=Poly_no0_27_mean, aes(x=Day.num, y=mean, group = Symbiont, color=Symbiont)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Symbiont), size=4, show.legend = T)+  
  geom_line(aes(color=Symbiont),linetype="dotted")+
  scale_color_manual(values=c('#EEA236FF','#46B8DAFF','#D43F3AFF','#5CB85CFF',"black"))+
   geom_point(shape = 1,size = 4,colour = "black")+
  xlab("") + #Label the X Axis
  #ylim(0,3200)+
       scale_x_continuous(breaks=seq(0, 14, 2), limits =c(0,14))+
       scale_y_log10(breaks = c(1,100,1000, 10000), limits=c(.1,5000))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border 
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("cells/larvae"))) +
  ggtitle("27C")+
  theme(plot.title = element_text(size=20, face = "italic", hjust=0.5));Poly_no0_27_mean_plot
``` 
30C
```{r}      
Poly_no0_30<-subset(CellCounts_no0_NOD1431C, Temp=="30")

Poly_no0_30_mean <- ddply(Poly_no0_30, c("Day", "Symbiont"), summarise, #summarize cell counts
                  N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame,  excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation 
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE)) #calculate max, could also calculate min () if desired  
 
Poly_no0_30_mean #display table

#change Day back to Numeric from Factor, reapply the actual numeric dates
Poly_no0_30_mean$Day.num<-as.numeric(Poly_no0_30_mean$Day)
Poly_no0_30_mean$Day.num[Poly_no0_30_mean$Day.num == 2] =7
Poly_no0_30_mean$Day.num[Poly_no0_30_mean$Day.num == 3] =14
Poly_no0_30_mean$Day.num[Poly_no0_30_mean$Day.num == 1] =3
  
#plot with yaxis log10, real data (not transformed)
Poly_no0_30_mean_plot<-ggplot(data=Poly_no0_30_mean, aes(x=Day.num, y=mean, group = Symbiont, color=Symbiont)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Symbiont), size=4, show.legend = T)+  
  geom_line(aes(color=Symbiont),linetype="dotted")+
  scale_color_manual(values=c('#EEA236FF','#46B8DAFF','#D43F3AFF','#5CB85CFF',"black"))+
   geom_point(shape = 1,size = 4,colour = "black")+
  xlab("") + #Label the X Axis
       scale_x_continuous(breaks=seq(0, 14, 2), limits =c(0,14))+
   # ylim(0,3200)+
       scale_y_log10(breaks = c(1,100,1000, 10000), limits=c(.1,5000))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border 
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(""))) +
  ggtitle("30C")+
  theme(plot.title = element_text(size=20, face = "italic", hjust=0.5));Poly_no0_30_mean_plot
``` 
31C
```{r}       
Poly_no0_31<-subset(CellCounts_no0_NOD1431C, Temp=="31")

Poly_no0_31_mean <- ddply(Poly_no0_31, c("Day", "Symbiont"), summarise, #summarize cell counts
                  N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame,  excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation 
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE)) #calculate max, could also calculate min () if desired  
 
Poly_no0_31_mean #display table

#change Day back to Numeric from Factor, reapply the actual numeric dates
Poly_no0_31_mean$Day.num<-as.numeric(Poly_no0_31_mean$Day)
Poly_no0_31_mean$Day.num[Poly_no0_31_mean$Day.num == 2] =7
Poly_no0_31_mean$Day.num[Poly_no0_31_mean$Day.num == 3] =14
Poly_no0_31_mean$Day.num[Poly_no0_31_mean$Day.num == 1] =3

#remove Day 14 due to low ns
Poly_no0_31_mean<-subset(Poly_no0_31_mean, Day=="3"|Day=="7")

#plot with yaxis log10, real data (not transformed)
Poly_no0_31_mean_plot<-ggplot(data=Poly_no0_31_mean, aes(x=Day.num, y=mean, group = Symbiont, color=Symbiont)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Symbiont), size=4, show.legend = T)+  
  geom_line(aes(color=Symbiont),linetype="dotted")+
  scale_color_manual(values=c('#EEA236FF','#46B8DAFF','#D43F3AFF','#5CB85CFF',"black"))+
   geom_point(shape = 1,size = 4,colour = "black")+
  xlab("") + #Label the X Axis
       scale_x_continuous(breaks=seq(0, 14, 2), limits =c(0,14))+
   # ylim(0,3200)+
    scale_y_log10(breaks = c(1,100,1000, 10000), limits=c(.1,5000))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border 
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(""))) +
  ggtitle("31C")+
  theme(plot.title = element_text(size=20, face = "italic", hjust=0.5));Poly_no0_31_mean_plot



#####make plot with D14 31C, CellCounts_no0_mean

CellCounts_no0_mean_31<-subset(CellCounts_no0, Temp=="31")

CellCounts_no0_mean_31_mean <- ddply(CellCounts_no0_mean_31, c("Day", "Symbiont"), summarise, #summarize cell counts
                  N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame,  excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation 
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE)) #calculate max, could also calculate min () if desired  
 
CellCounts_no0_mean_31_mean #display table

#change Day back to Numeric from Factor, reapply the actual numeric dates
CellCounts_no0_mean_31_mean$Day.num<-as.numeric(CellCounts_no0_mean_31_mean$Day)
CellCounts_no0_mean_31_mean$Day.num[CellCounts_no0_mean_31_mean$Day.num == 2] =7
CellCounts_no0_mean_31_mean$Day.num[CellCounts_no0_mean_31_mean$Day.num == 3] =14
CellCounts_no0_mean_31_mean$Day.num[CellCounts_no0_mean_31_mean$Day.num == 1] =3
CellCounts_no0_mean_31_mean


#plot with yaxis log10, real data (not transformed)
CellCounts_no0_mean_31_mean_plot<-ggplot(data=CellCounts_no0_mean_31_mean, aes(x=Day.num, y=mean, group = Symbiont, color=Symbiont)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Symbiont), size=4, show.legend = T)+  
  geom_line(aes(color=Symbiont),linetype="dotted")+
  scale_color_manual(values=c('#EEA236FF','#46B8DAFF','#D43F3AFF','#5CB85CFF',"black"))+
   geom_point(shape = 1,size = 4,colour = "black")+
  xlab("") + #Label the X Axis
       scale_x_continuous(breaks=seq(0, 14, 2), limits =c(0,14))+
   # ylim(0,3200)+
    scale_y_log10(breaks = c(1,100,1000, 10000), limits=c(.1,5000))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border 
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(""))) +
  ggtitle("31C")+
  theme(plot.title = element_text(size=20, face = "italic", hjust=0.5));CellCounts_no0_mean_31_mean_plot

``` 
Plot all four No-CHOICE  together: Figure 2
```{r}  
#log scale axis only   
Poly_no0_27_mean_plot<-Poly_no0_27_mean_plot+ theme(legend.position = "none") #remove legend
Poly_no0_30_mean_plot<-Poly_no0_30_mean_plot+ theme(legend.position = "none") #remove legend
Poly_no0_31_mean_plot<-Poly_no0_31_mean_plot+ theme(legend.position = "none") #remove legend
  CellCounts_no0_mean_31_mean_plot<-CellCounts_no0_mean_31_mean_plot+ theme(legend.position = "none") #remove legend

grid.arrange(Poly_no0_27_mean_plot, Poly_no0_30_mean_plot, CellCounts_no0_mean_31_mean_plot, nrow = 1) 








# print binomial and counts
grid.arrange(Binary_27_mean_plot, Binary_30_mean_plot, Binary_31_31CD13_mean_plot,Poly_no0_27_mean_plot, Poly_no0_30_mean_plot, CellCounts_no0_mean_31_mean_plot, nrow = 2)

```
Plots By genus: SI FigS3 
C1
```{r}     
Singles_no0_C1<-subset(CellCounts_no0_NOD1431C, Symbiont=="C1")

Singles_no0_C1_mean <- ddply(Singles_no0_C1, c("Day", "Temp"), summarise, #summarize cell counts
                  N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame,  excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation 
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE)) #calculate max, could also calculate min () if desired  
 
Singles_no0_C1_mean #display table

#change Day back to Numeric from Factor, reapply the actual numeric dates
Singles_no0_C1_mean$Day.num<-as.numeric(Singles_no0_C1_mean$Day)
Singles_no0_C1_mean$Day.num[Singles_no0_C1_mean$Day.num == 2] =7
Singles_no0_C1_mean$Day.num[Singles_no0_C1_mean$Day.num == 3] =14
Singles_no0_C1_mean$Day.num[Singles_no0_C1_mean$Day.num == 1] =3
 

Singles_no0_C1_mean_remove31D14<-Singles_no0_C1_mean[!(Singles_no0_C1_mean$N=="3" ),] # REMOVE day 14 31C bc n=3 (n<5)



#plot with yaxis log10, real data (not transformed)
Singles_no0_C1_mean_plot<-ggplot(data=Singles_no0_C1_mean_remove31D14, aes(x=Day.num, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=4, show.legend = T)+  
  geom_line(aes(color=Temp),linetype="dotted")+
  scale_color_manual(values=c('blue','orange','red'))+
   geom_point(shape = 1,size = 4,colour = "black")+
  xlab("Day") + #Label the X Axis
  #ylim(0,3200)+
       scale_x_continuous(breaks=seq(0, 14, 2), limits =c(0,14))+
       scale_y_log10(breaks = c(0,1,100,1000, 10000), limits=c(.1,5000))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border 
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("cells/larvae"))) +
  ggtitle("C1C Cell Counts")+
  theme(plot.title = element_text(size=20, face = "italic", hjust=0.5));Singles_no0_C1_mean_plot
``` 
D1
```{r}     
Singles_no0_D1<-subset(CellCounts_no0_NOD1431C, Symbiont=="D1")

Singles_no0_D1_mean <- ddply(Singles_no0_D1, c("Day", "Temp"), summarise, #summarize cell counts
                  N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame,  excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation 
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE)) #calculate max, could also calculate min () if desired  
 
Singles_no0_D1_mean #display table

#change Day back to Numeric from Factor, reapply the actual numeric dates
Singles_no0_D1_mean$Day.num<-as.numeric(Singles_no0_D1_mean$Day)
Singles_no0_D1_mean$Day.num[Singles_no0_D1_mean$Day.num == 2] =7
Singles_no0_D1_mean$Day.num[Singles_no0_D1_mean$Day.num == 3] =14
Singles_no0_D1_mean$Day.num[Singles_no0_D1_mean$Day.num == 1] =3
 
#plot with yaxis log10, real data (not transformed)
Singles_no0_D1_mean_plot<-ggplot(data=Singles_no0_D1_mean, aes(x=Day.num, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=4, show.legend = T)+  
  geom_line(aes(color=Temp),linetype="dotted")+
  scale_color_manual(values=c('blue','orange','red'))+
   geom_point(shape = 1,size = 4,colour = "black")+
  xlab("Day") + #Label the X Axis
  #ylim(0,3200)+
       scale_x_continuous(breaks=seq(0, 14, 2), limits =c(0,14))+
       scale_y_log10(breaks = c(0,1,100,1000, 10000), limits=c(.1,5000))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border 
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("cells/larvae"))) +
  ggtitle("D1C Cell Counts")+
  theme(plot.title = element_text(size=20, face = "italic", hjust=0.5));Singles_no0_D1_mean_plot
```
F1
```{r}     
Singles_no0_F1<-subset(CellCounts_no0_NOD1431C, Symbiont=="F1")

Singles_no0_F1_mean <- ddply(Singles_no0_F1, c("Day", "Temp"), summarise, #summarize cell counts
                  N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame,  excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation 
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE)) #calculate max, could also calculate min () if desired  
 
Singles_no0_F1_mean #display table

#change Day back to Numeric from Factor, reapply the actual numeric dates
Singles_no0_F1_mean$Day.num<-as.numeric(Singles_no0_F1_mean$Day)
Singles_no0_F1_mean$Day.num[Singles_no0_F1_mean$Day.num == 2] =7
Singles_no0_F1_mean$Day.num[Singles_no0_F1_mean$Day.num == 3] =14
Singles_no0_F1_mean$Day.num[Singles_no0_F1_mean$Day.num == 1] =3
 
#plot with yaxis log10, real data (not transformed)
Singles_no0_F1_mean_plot<-ggplot(data=Singles_no0_F1_mean, aes(x=Day.num, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=4, show.legend = T)+  
  geom_line(aes(color=Temp),linetype="dotted")+
  scale_color_manual(values=c('blue','orange','red'))+
   geom_point(shape = 1,size = 4,colour = "black")+
  xlab("Day") + #Label the X Axis
  #ylim(0,3200)+
       scale_x_continuous(breaks=seq(0, 14, 2), limits =c(0,14))+
       scale_y_log10(breaks = c(0,1,100,1000, 10000), limits=c(.1,5000))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border 
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("cells/larvae"))) +
  ggtitle("F1C Cell Counts")+
  theme(plot.title = element_text(size=20, face = "italic", hjust=0.5));Singles_no0_F1_mean_plot
```
G3
```{r}     
Singles_no0_G3<-subset(CellCounts_no0_NOD1431C, Symbiont=="G3")

Singles_no0_G3_mean <- ddply(Singles_no0_G3, c("Day", "Temp"), summarise, #summarize cell counts
                  N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame,  excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation 
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE)) #calculate max, could also calculate min () if desired  
 
Singles_no0_G3_mean #display table

#change Day back to Numeric from Factor, reapply the actual numeric dates
Singles_no0_G3_mean$Day.num<-as.numeric(Singles_no0_G3_mean$Day)
Singles_no0_G3_mean$Day.num[Singles_no0_G3_mean$Day.num == 2] =7
Singles_no0_G3_mean$Day.num[Singles_no0_G3_mean$Day.num == 3] =14
Singles_no0_G3_mean$Day.num[Singles_no0_G3_mean$Day.num == 1] =3
 
#plot with yaxis log10, real data (not transformed)
Singles_no0_G3_mean_plot<-ggplot(data=Singles_no0_G3_mean, aes(x=Day.num, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=4, show.legend = T)+  
  geom_line(aes(color=Temp),linetype="dotted")+
  scale_color_manual(values=c('blue','orange','red'))+
   geom_point(shape = 1,size = 4,colour = "black")+
  xlab("Day") + #Label the X Axis
  #ylim(0,3200)+
       scale_x_continuous(breaks=seq(0, 14, 2), limits =c(0,14))+
       scale_y_log10(breaks = c(0,1,100,1000, 10000), limits=c(.1,5000))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border 
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("cells/larvae"))) +
  ggtitle("G3C Cell Counts")+
  theme(plot.title = element_text(size=20, face = "italic", hjust=0.5));Singles_no0_G3_mean_plot
```
ALL
```{r}     
Singles_no0_ALL<-subset(CellCounts_no0_NOD1431C, Symbiont=="Poly")

Singles_no0_ALL_mean <- ddply(Singles_no0_ALL, c("Day", "Temp"), summarise, #summarize cell counts
                  N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame,  excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation 
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE)) #calculate max, could also calculate min () if desired  
 
Singles_no0_ALL_mean #display table

#change Day back to Numeric from Factor, reapply the actual numeric dates
Singles_no0_ALL_mean$Day.num<-as.numeric(Singles_no0_ALL_mean$Day)
Singles_no0_ALL_mean$Day.num[Singles_no0_ALL_mean$Day.num == 2] =7
Singles_no0_ALL_mean$Day.num[Singles_no0_ALL_mean$Day.num == 3] =14
Singles_no0_ALL_mean$Day.num[Singles_no0_ALL_mean$Day.num == 1] =3
 
#plot with yaxis log10, real data (not transformed)
Singles_no0_ALL_mean_plot<-ggplot(data=Singles_no0_ALL_mean, aes(x=Day.num, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=4, show.legend = T)+  
  geom_line(aes(color=Temp),linetype="dotted")+
  scale_color_manual(values=c('blue','orange','red'))+
   geom_point(shape = 1,size = 4,colour = "black")+
  xlab("Day") + #Label the X Axis
  #ylim(0,3200)+
       scale_x_continuous(breaks=seq(0, 14, 2), limits =c(0,14))+
       scale_y_log10(breaks = c(0,1,100,1000, 10000), limits=c(.1,5000))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border 
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("cells/larvae"))) +
  ggtitle("ALL Cell Counts")+
  theme(plot.title = element_text(size=20, face = "italic", hjust=0.5));Singles_no0_ALL_mean_plot
```
Plot all together
```{r}  
#log scale axis only   
Singles_no0_C1_mean_plot<-Singles_no0_C1_mean_plot+ theme(legend.position = "none") #remove legend
Singles_no0_D1_mean_plot<-Singles_no0_D1_mean_plot+ theme(legend.position = "none") #remove legend
Singles_no0_F1_mean_plot<-Singles_no0_F1_mean_plot+ theme(legend.position = "none") #remove legend
Singles_no0_G3_mean_plot<-Singles_no0_G3_mean_plot+ theme(legend.position = "none") #remove legend
Singles_no0_ALL_mean_plot<-Singles_no0_ALL_mean_plot+ theme(legend.position = "none") #remove legend

grid.arrange(Singles_no0_C1_mean_plot, Singles_no0_D1_mean_plot, Singles_no0_F1_mean_plot, Singles_no0_G3_mean_plot,Singles_no0_ALL_mean_plot,nrow = 2) 




```


# N0-choice vs 4-way choice-infection: Cell Counts PLOTS (Blue and pink plots), only infected larva
C1            
C1Full2 = Single cells.larvae raw
ALLcast_9000_cast2a = 4-way that infected  
```{r}        
MultiCounts<-ALLcast_9000_cast2a
MultiCounts2<-MultiCounts[-c(5:8)] #remove metadata
MultiCounts2$single.multi<-"multi"
MultiCounts2$ALL.number<-as.factor(MultiCounts2$ALL.number)
MultiCounts2$single.multi<-as.factor(MultiCounts2$single.multi)

names(MultiCounts2)[names(MultiCounts2) == "C1_round"] <- "C1"
names(MultiCounts2)[names(MultiCounts2) == "D1_round"] <- "D1" 
names(MultiCounts2)[names(MultiCounts2) == "F1_round"] <- "F1"
names(MultiCounts2)[names(MultiCounts2) == "G3_round"] <- "G3"
 MultiCounts2<-MultiCounts2[-c(1)] #remove ALL.number after confirming df correct

#MultiCounts2$Symbiont<-"All"
MultiCounts2<-melt(MultiCounts2, id=c("Temp","Day","single.multi","Pot"))
colnames(MultiCounts2)[colnames(MultiCounts2)=="value"]<-"cells.larvae_round" #rename value col
colnames(MultiCounts2)[colnames(MultiCounts2)=="variable"]<-"Symbiont" #rename value col


SingleCounts<-rbind(C1Full_no0,D1Full_no0,F1Full_no0,G3Full_no0)
SingleCounts<-SingleCounts[-c(5:7)] #remove metadata
SingleCounts$cells.larvae_round<-SingleCounts$cells.larvae_counts_unlog #rename
SingleCounts$cells.larvae_round<-round(SingleCounts$cells.larvae_round)
SingleCounts<-SingleCounts[-c(5)] #remove duplicate col
SingleCounts$single.multi<-"single"
SingleCounts$single.multi<-as.factor(SingleCounts$single.multi)

CountsCompare<-rbind(SingleCounts, MultiCounts2) # combine monoculture and poly (for each genus)

#### REMOVE 0s from countscompare
CountsCompare2<-filter(CountsCompare, cells.larvae_round > 0) #fileter out 0s

#MEANs
CountsCompare2_mean <- ddply(CountsCompare2, c("single.multi","Temp","Day","Symbiont"), summarise, #summarize cell count
                 N    = length(cells.larvae_round[!is.na(cells.larvae_round)]), #calculate the length of the data frame, excluding NA’s *this part is important* 
                 mean = mean(cells.larvae_round, na.rm=TRUE), #calculate mean of response variable, removing NA's
                  sd   = sd(cells.larvae_round, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                  max = max(cells.larvae_round, na.rm=TRUE) #calculate max, could also calculate min () if desired
) 
CountsCompare2_mean #display table
CountsCompare2_mean<-na.omit(CountsCompare2_mean)
#make a code
CountsCompare2_mean$code<-paste0(CountsCompare2_mean$single.multi, "_", CountsCompare2_mean$Temp) #code
CountsCompare2_mean<-CountsCompare2_mean[ , order(names(CountsCompare2_mean))]
CountsCompare2_mean<-na.omit(CountsCompare2_mean)
CountsCompare2_mean
#######C1 31C day 7 only has 2 larva with non-0s,  remove
#change Day back to Numeric from Factor, reapply the actual numeric dates
CountsCompare2_mean$Day<-as.numeric(CountsCompare2_mean$Day)
CountsCompare2_mean$Day[CountsCompare2_mean$Day == 2] =7
CountsCompare2_mean$Day[CountsCompare2_mean$Day == 3] =14
CountsCompare2_mean$Day[CountsCompare2_mean$Day == 1] =3
 
#subset by temp
CountsCompare2_mean_27<-subset(CountsCompare2_mean, Temp=="27")
CountsCompare2_mean_30<-subset(CountsCompare2_mean, Temp=="30")
CountsCompare2_mean_31<-subset(CountsCompare2_mean, Temp=="31")
```
subset by Symbiont plots
C1: 27C  
```{r}              
#subset C1 
CountsCompare2_C1_27<-subset(CountsCompare2_mean_27, Symbiont=="C1")
 
CountsCompare2_C1_plot27<-ggplot(data=CountsCompare2_C1_27, aes(x=Day, y=mean, group=single.multi, color=single.multi)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.3, show.legend = T)+
  geom_point(aes(color=single.multi), size=4.5, show.legend = T)+
     geom_point(shape = 1,size = 5,colour = "black")+
  geom_line(aes(color=single.multi, linetype=single.multi))+
    scale_linetype_manual(values=c("dotted", "solid"))+
  scale_color_manual(values=c( "turquoise3","deeppink3"))+
  xlab("") + #Label the X Axis
     scale_y_log10(breaks = c(0,1,100,1000, 10000), limits=c(1,5000))+  
  xlab("") + 
       scale_x_continuous(breaks=seq(0, 14, 2), limits =c(0,15))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(italic("Cladocopium")))) +
  ggtitle("27C")+
  theme(plot.title = element_text(size=20, hjust=0.5));CountsCompare2_C1_plot27


```
C1: 30C
```{r}   
#Subset 30 
CountsCompare2_C1_30<-subset(CountsCompare2_mean_30, Symbiont=="C1")

CountsCompare2_C1_plot30<-ggplot(data=CountsCompare2_C1_30, aes(x=Day, y=mean, group=single.multi,color=single.multi)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.3, show.legend = T)+
   geom_point(aes(color=single.multi), size=4.5, show.legend = T)+
     geom_point(shape = 1,size = 5,colour = "black")+
  geom_line(aes(color=single.multi, linetype=single.multi))+
      scale_linetype_manual(values=c("dotted", "solid"))+
  scale_color_manual(values=c( "turquoise3","deeppink3"))+
  xlab("") + #Label the X Axis
       scale_y_log10(breaks = c(0,1,100,1000, 10000), limits=c(1,5000))+  xlab("") +
       scale_x_continuous(breaks=seq(0, 14, 2), limits =c(0,15))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(""))) +
  ggtitle("30C")+
  theme(plot.title = element_text(size=20, hjust=0.5));CountsCompare2_C1_plot30
```

C1: 31C
```{r}  
#Subset 31 - day 7 multi is only 2. see below for just day 3 comparison
CountsCompare2_C1_31<-subset(CountsCompare2_mean_31, Symbiont=="C1" & Day=="3")

CountsCompare2_C1_plot31<-ggplot(data=CountsCompare2_C1_31, aes(x=Day, y=mean, group=single.multi,color=single.multi)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.3, show.legend = T,position = position_dodge(width = 0.5))+
   geom_point(aes(color=single.multi), size=4.5,position = position_dodge(width = 0.5), show.legend = T)+
     geom_point(shape = 1,size = 5,colour = "black",position = position_dodge(width = 0.5))+
  geom_line(aes(color=single.multi, linetype=single.multi))+
      scale_linetype_manual(values=c("dotted", "solid"))+
  scale_color_manual(values=c( "turquoise3","deeppink3"))+
  xlab("") + #Label the X Axis
       scale_y_log10(breaks = c(0,1,100,1000, 10000), limits=c(1,5000))+  xlab("") + 
       scale_x_continuous(breaks=seq(0, 14, 2), limits =c(0,15))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines 
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(""))) +
  ggtitle("31C")+
  theme(plot.title = element_text(size=20, hjust=0.5));CountsCompare2_C1_plot31 
```
D1
D1: 27C
```{r} 
CountsCompare2_D1<-subset(CountsCompare2_mean_27, Symbiont=="D1")
 
CountsCompare2_D1_plot27<-ggplot(data=CountsCompare2_D1, aes(x=Day, y=mean, group=single.multi, color=single.multi)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.3, show.legend = T)+
  geom_point(aes(color=single.multi), size=4.5, show.legend = T)+
  geom_line(aes(color=single.multi, linetype=single.multi))+
      scale_linetype_manual(values=c("dotted", "solid"))+
     geom_point(shape = 1,size = 5,colour = "black")+
  scale_color_manual(values=c( "turquoise3","deeppink3"))+
  xlab("") + #Label the X Axis
       scale_y_log10(breaks = c(0,1,100,1000, 10000), limits=c(1,5000))+  xlab("") + 
       scale_x_continuous(breaks=seq(0, 14, 2), limits =c(0,15))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(italic("Durusdinium")))) +
  ggtitle("")+
  theme(plot.title = element_text(size=20, face = "italic"));CountsCompare2_D1_plot27

```
D1: 30C
```{r}
#Subset 30 
CountsCompare2_D1_30<-subset(CountsCompare2_mean_30, Symbiont=="D1")
 
CountsCompare2_D1_plot30<-ggplot(data=CountsCompare2_D1_30, aes(x=Day, y=mean, group=single.multi,color=single.multi)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.3, show.legend = T)+
   geom_point(aes(color=single.multi), size=4.5, show.legend = T)+
     geom_point(shape = 1,size = 5,colour = "black")+
  geom_line(aes(color=single.multi, linetype=single.multi))+
      scale_linetype_manual(values=c("dotted", "solid"))+
  scale_color_manual(values=c( "turquoise3","deeppink3"))+
  xlab("") + #Label the X Axis
      scale_y_log10(breaks = c(0,1,100,1000, 10000), limits=c(1,5000))+  xlab("") +
       scale_x_continuous(breaks=seq(0, 14, 2), limits =c(0,15))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(""))) +
  ggtitle("")+
  theme(plot.title = element_text(size=20, face = "italic"));CountsCompare2_D1_plot30

```
D1: 31C
```{r}
#Subset 31 
CountsCompare2_D1_31<-subset(CountsCompare2_mean_31, Symbiont=="D1")
 CountsCompare2_D1_31<-subset(CountsCompare2_D1_31, Day=="3" |Day=="7")

CountsCompare2_D1_plot31<-ggplot(data=CountsCompare2_D1_31, aes(x=Day, y=mean, group=single.multi,color=single.multi)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.3, show.legend = T)+
   geom_point(aes(color=single.multi), size=4.5, show.legend = T)+
     geom_point(shape = 1,size = 5,colour = "black")+
  geom_line(aes(color=single.multi, linetype=single.multi))+
      scale_linetype_manual(values=c("dotted", "solid"))+
  scale_color_manual(values=c( "turquoise3","deeppink3"))+
  xlab("") + #Label the X Axis
      scale_y_log10(breaks = c(-100,1,100,1000, 10000), limits=c(1,5000))+  xlab("") + 
       scale_x_continuous(breaks=seq(0, 14, 2), limits =c(0,15))+
  expand_limits(x = 14, y = 0)+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(""))) +
  ggtitle("")+
  theme(plot.title = element_text(size=20, face = "italic"));CountsCompare2_D1_plot31
```
F1
F1: 27C
```{r} 
#subset F1 
CountsCompare2_F1<-subset(CountsCompare2_mean_27, Symbiont=="F1")
  

CountsCompare2_F1_plot27<-ggplot(data=CountsCompare2_F1, aes(x=Day, y=mean, group=single.multi, color=single.multi)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.3, show.legend = T)+
  geom_point(aes(color=single.multi), size=4.5, show.legend = T)+
     geom_point(shape = 1,size = 5,colour = "black")+
  geom_line(aes(color=single.multi, linetype=single.multi))+
      scale_linetype_manual(values=c("dotted", "solid"))+
  scale_color_manual(values=c( "turquoise3","deeppink3"))+
  xlab("") + #Label the X Axis
       scale_y_log10(breaks = c(0,1,100,1000, 10000), limits=c(1,5000))+  xlab("") + 
       scale_x_continuous(breaks=seq(0, 14, 2), limits =c(0,15))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(italic("Fugacium")))) +
  ggtitle("")+
  theme(plot.title = element_text(size=20, face = "italic"));CountsCompare2_F1_plot27

```
F1: 30C
```{r}
#Subset 30
CountsCompare2_F1_30<-subset(CountsCompare2_mean_30, Symbiont=="F1")
 

CountsCompare2_F1_plot30<-ggplot(data=CountsCompare2_F1_30, aes(x=Day, y=mean, group=single.multi,color=single.multi)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.3, show.legend = T)+
   geom_point(aes(color=single.multi), size=4.5, show.legend = T)+
     geom_point(shape = 1,size = 5,colour = "black")+
  geom_line(aes(color=single.multi, linetype=single.multi))+
      scale_linetype_manual(values=c("dotted", "solid"))+
  scale_color_manual(values=c( "turquoise3","deeppink3"))+
  xlab("") + #Label the X Axis
       scale_y_log10(breaks = c(0,1,100,1000, 10000), limits=c(1,5000))+  xlab("") +
       scale_x_continuous(breaks=seq(0, 14, 2), limits =c(0,15))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(""))) +
  ggtitle("")+
  theme(plot.title = element_text(size=20, face = "italic"));CountsCompare2_F1_plot30
```
F1: 31C
```{r} 
#Subset 31
CountsCompare2_F1_31<-subset(CountsCompare2_mean_31, Symbiont=="F1")
 CountsCompare2_F1_31<-subset(CountsCompare2_F1_31, Day=="3" |Day=="7")

CountsCompare2_F1_plot31<-ggplot(data=CountsCompare2_F1_31, aes(x=Day, y=mean, group=single.multi,color=single.multi)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.3, show.legend = T)+
   geom_point(aes(color=single.multi), size=4.5, show.legend = T)+
     geom_point(shape = 1,size = 5,colour = "black")+
  geom_line(aes(color=single.multi, linetype=single.multi))+
      scale_linetype_manual(values=c("dotted", "solid"))+
  scale_color_manual(values=c( "turquoise3","deeppink3"))+
  xlab("") + #Label the X Axis
      scale_y_log10(breaks = c(-100,1,100,1000, 10000), limits=c(1,5000))+  xlab("") + 
       scale_x_continuous(breaks=seq(0, 14, 2), limits =c(0,15))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(""))) +
  ggtitle("")+
  theme(plot.title = element_text(size=20, face = "italic"));CountsCompare2_F1_plot31
```
G3
G3: 27C
```{r}
#subset G3   
CountsCompare2_G3<-subset(CountsCompare2_mean_27, Symbiont=="G3")


CountsCompare2_G3_plot27<-ggplot(data=CountsCompare2_G3, aes(x=Day, y=mean, group=single.multi, color=single.multi)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.3, show.legend = T)+
  geom_point(aes(color=single.multi), size=4.5, show.legend = T)+
  geom_line(aes(color=single.multi, linetype=single.multi))+
      scale_linetype_manual(values=c("dotted", "solid"))+
     geom_point(shape = 1,size = 5,colour = "black")+
  scale_color_manual(values=c( "turquoise3","deeppink3"))+
  xlab("") + #Label the X Axis
       scale_y_log10(breaks = c(0,1,100,1000, 10000), limits=c(1,5000))+  xlab("") + 
       scale_x_continuous(breaks=seq(0, 14, 2), limits =c(0,15))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(italic("Gerakladium")))) +
  ggtitle("")+
  theme(plot.title = element_text(size=20, face = "italic"));CountsCompare2_G3_plot27

```
G3: 30C
```{r} 
#Subset 30
CountsCompare2_G3_30<-subset(CountsCompare2_mean_30, Symbiont=="G3")

 
CountsCompare2_G3_plot30<-ggplot(data=CountsCompare2_G3_30, aes(x=Day, y=mean, group=single.multi,color=single.multi)) + 
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.3, show.legend = T)+
   geom_point(aes(color=single.multi), size=4.5, show.legend = T)+
     geom_point(shape = 1,size = 5,colour = "black")+
  geom_line(aes(color=single.multi, linetype=single.multi))+
      scale_linetype_manual(values=c("dotted", "solid"))+
  scale_color_manual(values=c( "turquoise3","deeppink3"))+
  xlab("") + #Label the X Axis
       scale_y_log10(breaks = c(0,1,100,1000, 10000), limits=c(1,5000))+  xlab("") + 
       scale_x_continuous(breaks=seq(0, 14, 2), limits =c(0,15))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(""))) +
  ggtitle("")+ 
  theme(plot.title = element_text(size=20, face = "italic"));CountsCompare2_G3_plot30

```
G3: 31C
```{r} 
#Subset 31
CountsCompare2_G3_31<-subset(CountsCompare2_mean_31, Symbiont=="G3")
 CountsCompare2_G3_31<-subset(CountsCompare2_G3_31, Day=="3" |Day=="7")

 
CountsCompare2_G3_plot31<-ggplot(data=CountsCompare2_G3_31, aes(x=Day, y=mean, group=single.multi,color=single.multi)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.3, show.legend = T)+
   geom_point(aes(color=single.multi), size=4.5, show.legend = T)+
     geom_point(shape = 1,size = 5,colour = "black")+
  geom_line(aes(color=single.multi, linetype=single.multi))+
      scale_linetype_manual(values=c("dotted", "solid"))+
  scale_color_manual(values=c( "turquoise3","deeppink3"))+
  xlab("") + #Label the X Axis
       scale_y_log10(breaks = c(-100,1,100,1000, 10000), limits=c(1,5000))+  xlab("") + 
       scale_x_continuous(breaks=seq(0, 14, 2), limits =c(0,15))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(""))) +
  ggtitle("")+
    theme(legend.position = c(0.8, 0.3),legend.title = element_blank())+
  theme(plot.title = element_text(size=20, face = "italic"));CountsCompare2_G3_plot31
```

Figure x. Plot 3x4:
```{r}  
#line plot  
CountsCompare2_G3_plot27<-CountsCompare2_G3_plot27+ theme(legend.position = "none")
CountsCompare2_G3_plot30<-CountsCompare2_G3_plot30+ theme(legend.position = "none")
CountsCompare2_G3_plot31<-CountsCompare2_G3_plot31+ theme(legend.position = "none")
grid.arrange(CountsCompare2_G3_plot27, CountsCompare2_G3_plot30, CountsCompare2_G3_plot31, nrow=1)

  
CountsCompare2_F1_plot27<-CountsCompare2_F1_plot27+ theme(legend.position = "none")
CountsCompare2_F1_plot30<-CountsCompare2_F1_plot30+ theme(legend.position = "none")
CountsCompare2_F1_plot31<-CountsCompare2_F1_plot31+ theme(legend.position = "none")
grid.arrange(CountsCompare2_F1_plot27, CountsCompare2_F1_plot30, CountsCompare2_F1_plot31, nrow=1)


CountsCompare2_D1_plot27<-CountsCompare2_D1_plot27+ theme(legend.position = "none")
CountsCompare2_D1_plot30<-CountsCompare2_D1_plot30+ theme(legend.position = "none")
CountsCompare2_D1_plot31<-CountsCompare2_D1_plot31+ theme(legend.position = "none")
grid.arrange(CountsCompare2_F1_plot27, CountsCompare2_F1_plot30, CountsCompare2_F1_plot31, nrow=1)

CountsCompare2_C1_plot27<-CountsCompare2_C1_plot27+ theme(legend.position = "none")
CountsCompare2_C1_plot30<-CountsCompare2_C1_plot30+ theme(legend.position = "none")
CountsCompare2_C1_plot31<-CountsCompare2_C1_plot31+ theme(legend.position = "none")
grid.arrange(CountsCompare2_C1_plot27, CountsCompare2_C1_plot30, CountsCompare2_C1_plot31, nrow=1)

 
grid.arrange(CountsCompare2_C1_plot27, CountsCompare2_C1_plot30, CountsCompare2_C1_plot31, CountsCompare2_D1_plot27,CountsCompare2_D1_plot30, CountsCompare2_D1_plot31,CountsCompare2_F1_plot27,CountsCompare2_F1_plot30,CountsCompare2_F1_plot31,CountsCompare2_G3_plot27,CountsCompare2_G3_plot30,CountsCompare2_G3_plot31, nrow = 4)


 
  
```
 
Plot Single and Multi raw counts infection plots 4x2  
```{r}   
     
InfectRaw_Fig1<-plot_grid(CountsCompare2_C1_plot27, CountsCompare2_C1_plot30, CountsCompare2_C1_plot31, CountsCompare2_D1_plot27,CountsCompare2_D1_plot30, CountsCompare2_D1_plot31,CountsCompare2_F1_plot27,CountsCompare2_F1_plot30,CountsCompare2_F1_plot31,CountsCompare2_G3_plot27,CountsCompare2_G3_plot30,CountsCompare2_G3_plot31, labels = "AUTO", ncol=3, nrow=4, rel_heights= c(1,1), rel_widths = c(1,1), label_size = 15);InfectRaw_Fig1 

```
  
# No-choice vs 4-way: (Pink and Blue Models by symbiont), infected only, SI Tab S8
```{r}            
#stats, log10:  
hist(CountsCompare2$cells.larvae_round)
CountsCompare2$cells.larvae_log<-log10(CountsCompare2$cells.larvae_round+1)
hist(CountsCompare2$cells.larvae_log) #normal
CountsCompare2$PotCode<-paste0(CountsCompare2$Symbiont, "_", CountsCompare2$Temp,"_", CountsCompare2$Pot) #code
  CountsCompare2$PotCode<-as.factor(CountsCompare2$PotCode)

CountsCompare2_C1<-subset(CountsCompare2, Symbiont=="C1")
  hist(CountsCompare2_C1$cells.larvae_log)
  
CountsCompare2_D1<-subset(CountsCompare2, Symbiont=="D1") 
  hist(CountsCompare2_D1$cells.larvae_log)

CountsCompare2_F1<-subset(CountsCompare2, Symbiont=="F1")
  hist(CountsCompare2_F1$cells.larvae_log)

CountsCompare2_G3<-subset(CountsCompare2, Symbiont=="G3")
  hist(CountsCompare2_G3$cells.larvae_log)

``` 
C1, full mod  
```{r}    
#C1 full 

#due to low n's at 31C day 7 and 14, remove
CountsCompare2_C1$REMOVE<-paste0(CountsCompare2_C1$PotCode, "_", CountsCompare2_C1$Day) #code
CountsCompare2_C1<-CountsCompare2_C1[CountsCompare2_C1$REMOVE != "C1_31_1_7", ] 
CountsCompare2_C1<-CountsCompare2_C1[CountsCompare2_C1$REMOVE != "C1_31_2_7", ] 
CountsCompare2_C1<-CountsCompare2_C1[CountsCompare2_C1$REMOVE != "C1_31_3_7", ] 
CountsCompare2_C1<-CountsCompare2_C1[CountsCompare2_C1$REMOVE != "C1_31_1_14", ] 
CountsCompare2_C1<-CountsCompare2_C1[CountsCompare2_C1$REMOVE != "C1_31_2_14", ] 
CountsCompare2_C1<-CountsCompare2_C1[CountsCompare2_C1$REMOVE != "C1_31_3_14", ] 
 
CountsCompare2_C1_mod<-lmer(cells.larvae_log~Temp*Day*single.multi+(1|PotCode),CountsCompare2_C1)
anova(CountsCompare2_C1_mod)
qqPlot(residuals(CountsCompare2_C1_mod))   # good
  emm<-emmeans(CountsCompare2_C1_mod,  ~ single.multi|Temp|Day, adjust="Tukey") 
    cld(emm)
    pairs(emm)

#model just for 27 and 30
CountsCompare2_C1_27C30C<-subset(CountsCompare2_C1, Temp=="27"|Temp=="30")
CountsCompare2_C1_27C30C_mod<-lmer(cells.larvae_log~Temp*Day*single.multi+(1|PotCode),CountsCompare2_C1_27C30C)
anova(CountsCompare2_C1_27C30C_mod)
qqPlot(residuals(CountsCompare2_C1_27C30C_mod))   # good
  emm<-emmeans(CountsCompare2_C1_27C30C_mod,  ~ single.multi|Temp|Day, adjust="Tukey") 
    cld(emm)
    pairs(emm)
 
#model just for D3 and D7
CountsCompare2_C1_D3D7<-subset(CountsCompare2_C1, Day=="3"|Day=="7")
CountsCompare2_C1_D3D7_mod<-lmer(cells.larvae_log~Temp*Day*single.multi+(1|PotCode),CountsCompare2_C1_D3D7)
anova(CountsCompare2_C1_D3D7_mod)
qqPlot(residuals(CountsCompare2_C1_D3D7_mod))   # good
  emm<-emmeans(CountsCompare2_C1_D3D7_mod,  ~ single.multi|Temp|Day, adjust="Tukey") 
    cld(emm)
    pairs(emm)
```

D1, full mod
```{r}
#D1
#full
hist(CountsCompare2_D1$cells.larvae_log)
CountsCompare2_D1_mod<-lmer(cells.larvae_log~Temp*Day*single.multi+(1|PotCode),CountsCompare2_D1)
anova(CountsCompare2_D1_mod)
qqPlot(residuals(CountsCompare2_D1_mod))   # good
   emm<-emmeans(CountsCompare2_D1_mod,  ~ single.multi|Temp|Day, adjust="Tukey") 
    cld(emm)
    pairs(emm)

#model just for 27 and 30
CountsCompare2_D1_27C30C<-subset(CountsCompare2_D1, Temp=="27"|Temp=="30")
CountsCompare2_D1_27C30C_mod<-lmer(cells.larvae_log~Temp*Day*single.multi+(1|PotCode),CountsCompare2_D1_27C30C)
anova(CountsCompare2_D1_27C30C_mod)
qqPlot(residuals(CountsCompare2_D1_27C30C_mod))   # good
  emm<-emmeans(CountsCompare2_D1_27C30C_mod,  ~ single.multi|Temp|Day, adjust="Tukey") 
    cld(emm)
    pairs(emm)

#model just for D3 and D7
CountsCompare2_D1_D3D7<-subset(CountsCompare2_D1, Day=="3"|Day=="7")
CountsCompare2_D1_D3D7_mod<-lmer(cells.larvae_log~Temp*Day*single.multi+(1|PotCode),CountsCompare2_D1_D3D7)
anova(CountsCompare2_D1_D3D7_mod)
qqPlot(residuals(CountsCompare2_D1_D3D7_mod))   # good
  emm<-emmeans(CountsCompare2_D1_D3D7_mod,  ~ single.multi|Temp|Day, adjust="Tukey") 
cld(emm)
pairs(emm)
```

F1, full mod  
```{r}
#due to low n's at 31C and 14, we need to remove
CountsCompare2_F1$REMOVE<-paste0(CountsCompare2_F1$PotCode, "_", CountsCompare2_F1$Day) #code
 
CountsCompare2_F1<-CountsCompare2_F1[CountsCompare2_F1$REMOVE != "F1_31_1_14", ] 
CountsCompare2_F1<-CountsCompare2_F1[CountsCompare2_F1$REMOVE != "F1_31_2_14", ] 
CountsCompare2_F1<-CountsCompare2_F1[CountsCompare2_F1$REMOVE != "F1_31_3_14", ] 

CountsCompare2_F1_mod<-lmer(cells.larvae_log~Temp*Day*single.multi+(1|PotCode),CountsCompare2_F1)
anova(CountsCompare2_F1_mod)
qqPlot(residuals(CountsCompare2_F1_mod))   # good
  emm<-emmeans(CountsCompare2_F1_mod,  ~ single.multi|Temp|Day, adjust="Tukey") 
    cld(emm)
    pairs(emm)

#model just for 27 and 30
CountsCompare2_F1_27C30C<-subset(CountsCompare2_F1, Temp=="27"|Temp=="30")
CountsCompare2_F1_mod<-lmer(cells.larvae_log~Temp*Day*single.multi+(1|PotCode),CountsCompare2_F1_27C30C)
anova(CountsCompare2_F1_mod)
qqPlot(residuals(CountsCompare2_F1_27C30C))   # good
  emm<-emmeans(CountsCompare2_F1_27C30C,  ~ single.multi|Temp|Day, adjust="Tukey") 
cld(emm)
pairs(emm)

#model just for D3 and D7
CountsCompare2_F1_D3D7<-subset(CountsCompare2_F1, Day=="3"|Day=="7")
CountsCompare2_F1_D3D7_mod<-lmer(cells.larvae_log~Temp*Day*single.multi+(1|PotCode),CountsCompare2_F1_D3D7)
anova(CountsCompare2_F1_D3D7_mod)
qqPlot(residuals(CountsCompare2_F1_D3D7_mod))   # good
  emm<-emmeans(CountsCompare2_F1_D3D7_mod,  ~ single.multi|Temp|Day, adjust="Tukey") 
cld(emm)
pairs(emm)

```

G3, full mod 
```{r}   
 #due to low n's at 31C and 14, we need to remove
CountsCompare2_G3$REMOVE<-paste0(CountsCompare2_G3$PotCode, "_", CountsCompare2_G3$Day) #code

CountsCompare2_G3<-CountsCompare2_G3[CountsCompare2_G3$REMOVE != "G3_31_1_14", ] 
CountsCompare2_G3<-CountsCompare2_G3[CountsCompare2_G3$REMOVE != "G3_31_2_14", ] 
CountsCompare2_G3<-CountsCompare2_G3[CountsCompare2_G3$REMOVE != "G3_31_3_14", ] 

CountsCompare2_G3_mod<-lmer(cells.larvae_log~Temp*Day*single.multi+(1|PotCode),CountsCompare2_G3)
anova(CountsCompare2_G3_mod)
qqPlot(residuals(CountsCompare2_G3_mod))   # good
  emm<-emmeans(CountsCompare2_G3_mod,  ~ single.multi|Temp|Day, adjust="Tukey") 
    cld(emm)
    pairs(emm)

#model just for 27 and 30
CountsCompare2_G3_27C30C<-subset(CountsCompare2_G3, Temp=="27"|Temp=="30")
CountsCompare2_G3_27C30C_mod<-lmer(cells.larvae_log~Temp*Day*single.multi+(1|PotCode),CountsCompare2_G3_27C30C)
anova(CountsCompare2_G3_27C30C_mod)
qqPlot(residuals(CountsCompare2_G3_27C30C_mod))   # good
  emm<-emmeans(CountsCompare2_G3_27C30C_mod,  ~ single.multi|Temp|Day, adjust="Tukey") 
cld(emm)
pairs(emm)

#model just for D3 and D7
CountsCompare2_G3_D3D7<-subset(CountsCompare2_G3, Day=="3"|Day=="7")
CountsCompare2_G3_D3D7_mod<-lmer(cells.larvae_log~Temp*Day*single.multi+(1|PotCode),CountsCompare2_G3_D3D7)
anova(CountsCompare2_G3_D3D7_mod)
qqPlot(residuals(CountsCompare2_G3_D3D7_mod))   # good
  emm<-emmeans(CountsCompare2_G3_D3D7_mod,  ~ single.multi|Temp|Day, adjust="Tukey") 
cld(emm)
pairs(emm)
```


# 4-way infection, % larvae infected with 0,1, 2, 3, or 4 species   
```{r}        
#figure out number of species per larva
aDatat<-ALLcast_9000_cast2a
aDatat<-na.omit(aDatat) #remove larae with values not present for all 4 genera

 aDatat$C1[aDatat$C1_round>0]<-1  #make new cols for infect or not 1 for infect, 0 not.
aDatat$C1[aDatat$C1_round==0]<-0
 aDatat$D1[aDatat$D1_round>0]<-1  #make new cols for infect or not 1 for infect, 0 not.
aDatat$D1[aDatat$D1_round==0]<-0
aDatat$F1[aDatat$F1_round>0]<-1  #make new cols for infect or not 1 for infect, 0 not.
aDatat$F1[aDatat$F1_round==0]<-0
 aDatat$G3[aDatat$G3_round>0]<-1  #make new cols for infect or not 1 for infect, 0 not.
aDatat$G3[aDatat$G3_round==0]<-0
  
  
  colnms=c("C1", "D1", "F1", "G3") # name cols to sum
aDatat$numbClades<-rowSums(aDatat[,colnms]) #new row with the sum of num of genera infected 
#write.csv(aDatat,"aDatat.csv")

#Do you need below? 
aDatat2<-aDatat[c("ALL.number","numbClades")] #new row with the sum of num of genera infected 
#combine this with the Rel Abund dataframe (ALL_RelA_b)

#pasted from belowto make the next df 
ALL_RelAbvar<-c("Day", "Temp", "Pot","ALL.number","C1_round","D1_round","F1_round" ,"G3_round")
ALL_RelAb_a<-ALL_RelAb[ALL_RelAbvar]
ALL_RelAb_b<-melt(ALL_RelAb_a, id=c("Day", "Temp", "ALL.number","Pot"), measure.vars = c("C1_round","D1_round","F1_round" ,"G3_round"))
colnames(ALL_RelAb_b)[colnames(ALL_RelAb_b)=="value"]<-"cells.larvae" #rename value col
colnames(ALL_RelAb_b)[colnames(ALL_RelAb_b)=="variable"]<-"Symbiont" #rename value col
ALL_RelAb_b<-na.omit(ALL_RelAb_b) #remove larvae with 0 infection in all larvae (keep only larva that infected)

aData3t<-merge(aDatat2,ALL_RelAb_b, by="ALL.number")


NumClades<-read.csv("NumberofGeneraperLarva_20200824.csv") #Spreadsheet of number of clades each larva infected with by treatments.day.temp

NumClades$T0_relA<-NumClades$T0/(NumClades$T0+NumClades$T1+NumClades$T2+NumClades$T3+NumClades$T4)
NumClades$T1_relA<-NumClades$T1/(NumClades$T0+NumClades$T1+NumClades$T2+NumClades$T3+NumClades$T4)
NumClades$T2_relA<-NumClades$T2/(NumClades$T0+NumClades$T1+NumClades$T2+NumClades$T3+NumClades$T4)
NumClades$T3_relA<-NumClades$T3/(NumClades$T0+NumClades$T1+NumClades$T2+NumClades$T3+NumClades$T4)
NumClades$T4_relA<-NumClades$T4/(NumClades$T0+NumClades$T1+NumClades$T2+NumClades$T3+NumClades$T4)

NumCladesA<-NumClades[-c(4:8)] #remove cols you dont need
NumCladesB<-melt(NumCladesA,  id=c("Temp","Day","Pot")) #meld df 
names(NumCladesB)[names(NumCladesB)=="value"] <- "NumGenera" #rename cols
names(NumCladesB)[names(NumCladesB)=="variable"] <- "Number"
NumCladesB$Temp<-as.factor(as.character((NumCladesB$Temp)))
NumCladesB$Day<-as.factor(as.character((NumCladesB$Day)))
NumCladesB$Pot<-as.factor(as.character((NumCladesB$Pot)))


#MEANs
NumCladesB_mean <- ddply(NumCladesB, c("Temp","Day","Number"), summarise, #summarize cell count
                 N    = length(NumGenera[!is.na(NumGenera)]), #calculate the length of the data frame, excluding NA’s *this part is important* 
                 mean = mean(NumGenera, na.rm=TRUE), #calculate mean of response variable, removing NA's
                  sd   = sd(NumGenera, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                  max = max(NumGenera, na.rm=TRUE) #calculate max, could also calculate min () if desired
) 
NumCladesB_mean #display table

NumCladesB_mean$Day <- factor(NumCladesB_mean$Day, levels = c("3", "7", "14")) #reorder factor

#Number of clades (no temp time) for how many larvae with 3 or 4 genera
NumCladesB_numbonly_mean <- ddply(NumCladesB, c("Number"), summarise, #summarize cell count
                 N    = length(NumGenera[!is.na(NumGenera)]), #calculate the length of the data frame, excluding NA’s *this part is important* 
                 mean = mean(NumGenera, na.rm=TRUE), #calculate mean of response variable, removing NA's
                  sd   = sd(NumGenera, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                  max = max(NumGenera, na.rm=TRUE) #calculate max, could also calculate min () if desired
) 
NumCladesB_numbonly_mean #display table
```
Stats for Numclades~temp*time (4-way only)
```{r}      
ALL_RelAvar<-c("Day", "Temp", "ALL.number","C1","D1","F1" ,"G3","Pot","numclade")
ALL_RelA_Infect<-RelA_CladeComp[ALL_RelAvar]

ALL_RelA_Infect2<-na.omit(ALL_RelA_Infect) #remove larva with not all 4 amped
ALL_RelA_Infect2$numclade<-as.factor(as.character(ALL_RelA_Infect2$numclade))
#summary(ALL_RelA_Infect2)

# df RelA_CladeComp
NumClades_stats<-ALL_RelA_Infect2 # make a copy 
NumClades_stats<-NumClades_stats[!(NumClades_stats$ALL.number=="115"),] #remove day 14 31C (single larva)

#make PotCode
NumClades_stats$PotCode<-paste0(NumClades_stats$Temp, NumClades_stats$Pot)
NumClades_stats$PotCode<-as.factor(as.character(NumClades_stats$PotCode))
NumClades_stats$numclade<-as.numeric(as.character(NumClades_stats$numclade))

#NumClades_stats$PotCode<-as.factor(as.character(NumClades_stats$PotCode))
hist(NumClades_stats$numclade)  #is this actually better?
skewness(NumClades_stats$numclade, na.rm = TRUE) #-1.11889 neg skew
  NumClades_stats$numclade_log2<-log10(NumClades_stats$numclade+1) #this doesn't help
  hist(NumClades_stats$numclade_log2)
write.csv(NumClades_stats,"numstats.csv")

#Kruskal test
#by  temp and day 

#27
NumClades_stats_27<-subset(NumClades_stats, Temp==27)
    kruskal.test(numclade~Day, data=NumClades_stats_27)
     
#30
NumClades_stats_30<-subset(NumClades_stats, Temp==30)
    kruskal.test(numclade~Day, data=NumClades_stats_30)

#31
NumClades_stats_31<-subset(NumClades_stats, Temp==31)
    kruskal.test(numclade~Day, data=NumClades_stats_31)
  
#day 3
NumClades_stats_D3<-subset(NumClades_stats, Day==3)
    kruskal.test(numclade~Temp, data=NumClades_stats_D3)
    
#day 7    
    NumClades_stats_D7<-subset(NumClades_stats, Day==7)
    kruskal.test(numclade~Temp, data=NumClades_stats_D7)
 #day 14   
     NumClades_stats_D14<-subset(NumClades_stats, Day==14)
    kruskal.test(numclade~Temp, data=NumClades_stats_D14)

```

Stacked bar plot for number of species per larva
```{r} 
### STACKED BAR PLOTS
NumCladesB_mean_27<-subset(NumCladesB_mean, Temp==27)
NumCladesB_mean_30<-subset(NumCladesB_mean, Temp==30)
NumCladesB_mean_31<-subset(NumCladesB_mean, Temp==31)

#27C  
# barplot 
Infect27_plot<-ggplot(NumCladesB_mean_27, aes(y=mean, x=Day, fill=Number)) + 
           geom_bar(stat="identity")+
  scale_fill_manual(values=c("#F7F7F7","#CCCCCC", "#969696" ,"#636363" ,"#252525"))+
            #scale_fill_locuszoom()+
   xlab("Day")+
 theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("# of types of symbionts"))) +
  ggtitle("27C");Infect27_plot   

#30C

#plot
Infect30_plot<-ggplot(NumCladesB_mean_30, aes(y=mean, x=Day, fill=Number)) + 
           geom_bar(stat="identity")+
  scale_fill_manual(values=c("#F7F7F7","#CCCCCC", "#969696" ,"#636363" ,"#252525"))+
   xlab("Day")+
 theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("# of types of symbionts"))) +
  ggtitle("30C");Infect30_plot  

#31C

#plot
Infect31_plot<-ggplot(NumCladesB_mean_31, aes(y=mean, x=Day, fill=Number)) + 
           geom_bar(stat="identity")+
  scale_fill_manual(values=c("#F7F7F7","#CCCCCC", "#969696" ,"#636363" ,"#252525"))+
   xlab("Day")+
 theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("# of types of symbionts"))) +
  ggtitle("31C");Infect31_plot  

#plot all together
Infect27_plot<-Infect27_plot+ theme(legend.position = "none") #remove legend
Infect30_plot<-Infect30_plot+ theme(legend.position = "none") #remove legend
Infect31_plot<-Infect31_plot+ theme(legend.position = "none") #remove legend

grid.arrange(Infect27_plot, Infect30_plot,Infect31_plot, nrow = 1)
 
```

#Fig  Competative-infection: Polycluture only, relative abundance of each clade  
What is the rel abund of each clade infected in each larvae, over time and at ambient and high temp. 
setup df     
```{r}             
#calc relative abundance for each   (any non infected larvae will NA out here)
ALL_RelAb$Cladocopium<-ALL_RelAb$C1/(ALL_RelAb$C1+ALL_RelAb$D1+ALL_RelAb$F1+ALL_RelAb$G3)
ALL_RelAb$Durusdinium<-ALL_RelAb$D1/(ALL_RelAb$C1+ALL_RelAb$D1+ALL_RelAb$F1+ALL_RelAb$G3)
ALL_RelAb$Fugacium<-ALL_RelAb$F1/(ALL_RelAb$C1+ALL_RelAb$D1+ALL_RelAb$F1+ALL_RelAb$G3)
ALL_RelAb$Gerakladium<-ALL_RelAb$G3/(ALL_RelAb$C1+ALL_RelAb$D1+ALL_RelAb$F1+ALL_RelAb$G3)

ALL_RelAbvar<-c("Day", "Temp", "Pot","ALL.number","Cladocopium","Durusdinium","Fugacium" ,"Gerakladium")
ALL_RelAb_a<-ALL_RelAb[ALL_RelAbvar]
ALL_RelAb_b<-melt(ALL_RelAb_a, id=c("Day", "Temp", "ALL.number","Pot"), measure.vars = c("Cladocopium","Durusdinium","Fugacium" ,"Gerakladium"))
colnames(ALL_RelAb_b)[colnames(ALL_RelAb_b)=="value"]<-"cells.larvae" #rename value col
colnames(ALL_RelAb_b)[colnames(ALL_RelAb_b)=="variable"]<-"Symbiont" #rename value col
ALL_RelAb_b<-na.omit(ALL_RelAb_b) #remove larvae with 0 infection in all larvae (due to possible extraction issue)
#write.csv(ALL_RelAb,"ALL_RelAb2021.csv")
``` 
  
Stats: Relative abundance, df = ALL_RelAb_b 
```{r}      
# arcsinsqrt has less heteroscedasticity

#Full model  
hist(ALL_RelAb_b$cells.larvae)
ALL_RelAb_b$cells.larvae_log<-log10(ALL_RelAb_b$cells.larvae+1)
hist(ALL_RelAb_b$cells.larvae_log)
qqnorm(ALL_RelAb_b$cells.larvae_log) #

ALL_RelAb_b$cells.larvae_arc<-asin(sqrt(ALL_RelAb_b$cells.larvae))
hist(ALL_RelAb_b$cells.larvae_arc)
qqnorm(ALL_RelAb_b$cells.larvae_arc) #
  ALL_RelAb_b$PotCode<-paste0(ALL_RelAb_b$Temp, ALL_RelAb_b$Pot,ALL_RelAb_b$clade )
 ALL_RelAb_b$PotCode<-as.factor(ALL_RelAb_b$PotCode) #make factor

 
# FULL MODEL lmer  symbionts*days*temp
ALL_RelAb_b_mod<-lmer(cells.larvae_arc~Symbiont*Day*Temp+(1|ALL.number)+(1|Pot), ALL_RelAb_b)
anova(ALL_RelAb_b_mod)
qqPlot(residuals(ALL_RelAb_b_mod))
  emm<-emmeans(ALL_RelAb_b_mod,  ~ Symbiont *Day*Temp, adjust="Tukey")
    cld(emm)
    pairs(emm)
  emm<-emmeans(ALL_RelAb_b_mod,  ~ Day *Temp|Symbiont, adjust="Tukey")
    cld(emm)
    pairs(emm)
  emm<-emmeans(ALL_RelAb_b_mod,  ~ Day |Temp*Symbiont, adjust="Tukey")
    cld(emm)
    pairs(emm)

##Subset 27 and 30C
ALL_RelAb_b_27C30C<-subset(ALL_RelAb_b, Temp=="27"|Temp=="30")

ALL_RelAb_b_27C30C_mod<-lmer(cells.larvae_arc~Symbiont*Day*Temp+(1|ALL.number)+(1|Pot), ALL_RelAb_b_27C30C)
anova(ALL_RelAb_b_27C30C_mod)
qqPlot(residuals(ALL_RelAb_b_27C30C_mod))   # meh
   emm<-emmeans(ALL_RelAb_b_27C30C_mod,  ~ Symbiont *Day*Temp, adjust="Tukey")
    cld(emm)
    pairs(emm)

##Subset Day 3 and D7
ALL_RelAb_b_D3D7<-subset(ALL_RelAb_b, Day=="3"|Day=="7")

ALL_RelAb_b_D3D7_mod<-lmer(cells.larvae_arc~Symbiont*Day*Temp+(1|ALL.number)+(1|Pot), ALL_RelAb_b_D3D7)
anova(ALL_RelAb_b_D3D7_mod)
qqPlot(residuals(ALL_RelAb_b_D3D7_mod))   # meh
  emm<-emmeans(ALL_RelAb_b_D3_mod,  ~ Symbiont |Temp, adjust="Tukey")
    cld(emm)
    pairs(emm)
```
Plot RA as stacked bar plots by Day and then by temp 
 
Figure 2B: By temps - weird boxplot chart (not used) AND BAR chart (used)
```{r}       
library(RColorBrewer)

ALL_RelAb_b$Day2<-ALL_RelAb_b$Day #change Day to numeric for plots
ALL_RelAb_b$Day2<-as.character(ALL_RelAb_b$Day2)
ALL_RelAb_b$Day2<-as.numeric(ALL_RelAb_b$Day2)

relabund_27<-subset(ALL_RelAb_b, Temp=="27")
relabund_30<-subset(ALL_RelAb_b, Temp=="30")
relabund_31<-subset(ALL_RelAb_b, Temp=="31")

#all
ALL_RelAb_mean <- ddply(ALL_RelAb_b, c("Day2","Symbiont",""), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
) 
ALL_RelAb_27_mean #display table
 
#27 
ALL_RelAb_27_mean <- ddply(relabund_27, c("Day2","Symbiont"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
) 
ALL_RelAb_27_mean #display table

#round to nearest integer
ALL_RelAb_27_mean$mean100<-ALL_RelAb_27_mean$mean*100
ALL_RelAb_27_mean$mean100r<-round(ALL_RelAb_27_mean$mean100, digits = 0)
 
 #30C means  
ALL_RelAb_30_mean <- ddply(relabund_30, c("Day2", "Symbiont"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
ALL_RelAb_30_mean #display table

#round to nearest integer
ALL_RelAb_30_mean$mean100<-ALL_RelAb_30_mean$mean*100
ALL_RelAb_30_mean$mean100r<-round(ALL_RelAb_30_mean$mean100, digits = 1)


#31C
ALL_RelAb_31_mean <- ddply(relabund_31, c("Day2", "Symbiont"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                  mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
ALL_RelAb_31_mean #display table

#round to nearest integer
ALL_RelAb_31_mean$mean100<-ALL_RelAb_31_mean$mean*100
ALL_RelAb_31_mean$mean100r<-round(ALL_RelAb_31_mean$mean100, digits = 0)  
 

# barplot 
RelAbund27_plot<-ggplot(ALL_RelAb_27_mean, aes(y=mean, x=Day2, fill=Symbiont)) + 
           geom_bar(stat="identity")+
  scale_fill_manual(values=c("#D43F3AFF","#EEA236FF","#5CB85CFF","#46B8DAFF"))+
            #scale_fill_locuszoom()+
   xlab("Day")+
 theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("RelAbund"))) +
  ggtitle("27C");RelAbund27_plot   

RelAbund30_plot<-ggplot(ALL_RelAb_30_mean, aes(y=mean, x=Day2, fill=Symbiont)) + 
           geom_bar(stat="identity")+
  scale_fill_manual(values=c("#D43F3AFF","#EEA236FF","#5CB85CFF","#46B8DAFF"))+
            #scale_fill_locuszoom()+
   xlab("Day")+
 theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("RelAbund"))) +
  ggtitle("27C");RelAbund30_plot

RelAbund31_plot<-ggplot(ALL_RelAb_31_mean, aes(y=mean, x=Day2, fill=Symbiont)) + 
           geom_bar(stat="identity")+
  scale_fill_manual(values=c("#D43F3AFF","#EEA236FF","#5CB85CFF","#46B8DAFF"))+
            #scale_fill_locuszoom()+
   xlab("Day")+
 theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("RelAbund"))) +
  ggtitle("27C");RelAbund31_plot

 #plot all together
RelAbund27_plot<-RelAbund27_plot+ theme(legend.position = "none") #remove legend
RelAbund30_plot<-RelAbund30_plot+ theme(legend.position = "none") #remove legend
RelAbund31_plot<-RelAbund31_plot+ theme(legend.position = "none") #remove legend

grid.arrange(RelAbund27_plot, RelAbund30_plot,RelAbund31_plot, nrow = 1)


``` 

ALL relative abundance Line plots (same as above but line with se)
```{r}      
 
#27C line plot
 ALL_STP_27_line<-ggplot(data=ALL_RelAb_27_mean, aes(x=Day2, y=mean, group = Symbiont, color=Symbiont)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point( size=4, show.legend = T)+ 
      scale_color_manual(values=c('#D43F3AFF','#EEA236FF','#5CB85CFF','#46B8DAFF'))+
       geom_point(shape = 1,size = 4,colour = "black")+
  geom_line(linetype="dotted")+
  xlab("Days") + #Label the X Axis 
  ylim(0, 1) + #set Y limits 
         scale_x_continuous(breaks=seq(0, 14, 2), limits =c(0,14))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("Relative Abundance"))) +
  ggtitle("27C_RelAbund")+
  theme(plot.title = element_text(size=20));ALL_STP_27_line


#30C line plot
 ALL_STP_30_line<-ggplot(data=ALL_RelAb_30_mean, aes(x=Day2, y=mean, group = Symbiont, color=Symbiont)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point( size=4, show.legend = T)+ 
      scale_color_manual(values=c('#D43F3AFF','#EEA236FF','#5CB85CFF','#46B8DAFF'))+
       geom_point(shape = 1,size = 4,colour = "black")+
  geom_line(linetype="dotted")+
  xlab("Days") + #Label the X Axis 
  ylim(0, 1) + #set Y limits 
          scale_x_continuous(breaks=seq(0, 14, 2), limits =c(0,14))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("Relative Abundance"))) +
  ggtitle("30C_RelAbund")+
  theme(plot.title = element_text(size=20));ALL_STP_30_line
 
 #31C line plot
 ALL_STP_31_line<-ggplot(data=ALL_RelAb_31_mean, aes(x=Day2, y=mean, group = Symbiont, color=Symbiont)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point( size=4, show.legend = T)+ 
      scale_color_manual(values=c('#D43F3AFF','#EEA236FF','#5CB85CFF','#46B8DAFF'))+
       geom_point(shape = 1,size = 4,colour = "black")+
  geom_line(linetype="dotted")+
  xlab("Days") + #Label the X Axis 
  ylim(0, 1) + #set Y limits 
  theme_bw() + #Set the background color
       scale_x_continuous(breaks=seq(0, 14, 2), limits =c(0,14))+
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("Relative Abundance"))) +
  ggtitle("31C_RelAbund")+
  theme(plot.title = element_text(size=20));ALL_STP_31_line
     
#plot all together
ALL_STP_27_line<-ALL_STP_27_line+ theme(legend.position = "none") #remove legend
ALL_STP_30_line<-ALL_STP_30_line+ theme(legend.position = "none") #remove legend
ALL_STP_31_line<-ALL_STP_31_line+ theme(legend.position = "none") #remove legend

grid.arrange(ALL_STP_27_line, ALL_STP_30_line,ALL_STP_31_line, nrow = 1)
       

#Rel abund by Genus
ALL_RelAb_genus<-ALL_RelAb_b #make copy
 
#mean
ALL_RelAb_genus_mean <- ddply(ALL_RelAb_genus, c("Day2","Symbiont","Temp"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
) 
ALL_RelAb_genus_mean #display table

#separate by genus
ALL_RelAb_C1_mean<-subset(ALL_RelAb_genus_mean, Symbiont=="Cladocopium")
ALL_RelAb_D1_mean<-subset(ALL_RelAb_genus_mean, Symbiont=="Durusdinium")
ALL_RelAb_F1_mean<-subset(ALL_RelAb_genus_mean, Symbiont=="Fugacium")
ALL_RelAb_G3_mean<-subset(ALL_RelAb_genus_mean, Symbiont=="Gerakladium")

#C1 plot
 ALL_RelAb_C1_mean_line<-ggplot(data=ALL_RelAb_C1_mean, aes(x=Day2, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point( size=4, show.legend = T)+ 
      scale_color_manual(values=c('blue','orange','red'))+
       geom_point(shape = 1,size = 4,colour = "black")+
  geom_line(linetype="dotted")+
  xlab("Days") + #Label the X Axis 
  ylim(0, 1) + #set Y limits 
  theme_bw() + #Set the background color
       scale_x_continuous(breaks=seq(0, 14, 2), limits =c(0,14))+
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("Relative Abundance"))) +
  ggtitle("C1 poly")+
  theme(plot.title = element_text(size=20));ALL_RelAb_C1_mean_line
 
 #D1 plot
 ALL_RelAb_D1_mean_line<-ggplot(data=ALL_RelAb_D1_mean, aes(x=Day2, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point( size=4, show.legend = T)+ 
      scale_color_manual(values=c('blue','orange','red'))+
       geom_point(shape = 1,size = 4,colour = "black")+
  geom_line(linetype="dotted")+
  xlab("Days") + #Label the X Axis 
  ylim(0, 1) + #set Y limits 
  theme_bw() + #Set the background color
       scale_x_continuous(breaks=seq(0, 14, 2), limits =c(0,14))+
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("Relative Abundance"))) +
  ggtitle("D1 poly")+
  theme(plot.title = element_text(size=20));ALL_RelAb_D1_mean_line
 
 #F1 plot
 ALL_RelAb_F1_mean_line<-ggplot(data=ALL_RelAb_F1_mean, aes(x=Day2, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point( size=4, show.legend = T)+ 
      scale_color_manual(values=c('blue','orange','red'))+
       geom_point(shape = 1,size = 4,colour = "black")+
  geom_line(linetype="dotted")+
  xlab("Days") + #Label the X Axis 
  ylim(0, 1) + #set Y limits 
  theme_bw() + #Set the background color
       scale_x_continuous(breaks=seq(0, 14, 2), limits =c(0,14))+
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("Relative Abundance"))) +
  ggtitle("F1 poly")+
  theme(plot.title = element_text(size=20));ALL_RelAb_F1_mean_line
 
 #G3 plot
 ALL_RelAb_G3_mean_line<-ggplot(data=ALL_RelAb_G3_mean, aes(x=Day2, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point( size=4, show.legend = T)+ 
      scale_color_manual(values=c('blue','orange','red'))+
       geom_point(shape = 1,size = 4,colour = "black")+
  geom_line(linetype="dotted")+
  xlab("Days") + #Label the X Axis 
  ylim(0, 1) + #set Y limits 
  theme_bw() + #Set the background color
       scale_x_continuous(breaks=seq(0, 14, 2), limits =c(0,14))+
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("Relative Abundance"))) +
  ggtitle("G3 poly")+
  theme(plot.title = element_text(size=20));ALL_RelAb_G3_mean_line
 
 
 #plot all together
ALL_RelAb_C1_mean_line<-ALL_RelAb_C1_mean_line+ theme(legend.position = "none") #remove legend
ALL_RelAb_D1_mean_line<-ALL_RelAb_D1_mean_line+ theme(legend.position = "none") #remove legend
ALL_RelAb_F1_mean_line<-ALL_RelAb_F1_mean_line+ theme(legend.position = "none") #remove legend
ALL_RelAb_G3_mean_line<-ALL_RelAb_G3_mean_line+ theme(legend.position = "none") #remove legend

grid.arrange(ALL_RelAb_C1_mean_line, ALL_RelAb_D1_mean_line,ALL_RelAb_F1_mean_line, ALL_RelAb_G3_mean_line,nrow = 1)
 
```
 



#Bar plots of relative abundance by individual larva Fig 4
```{r}     
aData<-RelA_binaryb
aData<-na.omit(aData) #remove larvae with values not present for all 4 genera
 # colnms=c("C1", "D1", "F1", "G3") # name cols to sum
#aData$numbClades<-rowSums(aData[,colnms]) #new row with the sum of num of genera infected 

aData2<-aData[c("ALL.number","numclade")] #new row with the sum of num of genera infected 
#combine this with the Rel Abund dataframe (ALL_RelA_b)


#pasted from below (l 57XX) to make the next df ALL_RelAb


ALL_RelAbvar<-c("Day", "Temp", "Pot","ALL.number","Cladocopium","Durusdinium","Fugacium" ,"Gerakladium")
ALL_RelAb_a2<-ALL_RelAb_a[ALL_RelAbvar]
ALL_RelAb_a2<-na.omit(ALL_RelAb_a2)

ALL_RelAb_b2<-melt(ALL_RelAb_a2, id=c("Day", "Temp", "ALL.number","Pot"), measure.vars = c("Cladocopium","Durusdinium","Fugacium" ,"Gerakladium"))
colnames(ALL_RelAb_b2)[colnames(ALL_RelAb_b2)=="value"]<-"cells.larvae" #rename value col
colnames(ALL_RelAb_b2)[colnames(ALL_RelAb_b2)=="variable"]<-"Symbiont" #rename value col

aData3<-merge(aData2,ALL_RelAb_b2, by="ALL.number") #merge number of species infected 
   
aData4<-aData3  #make copy

#27
aData4_27<-subset(aData4, Temp==27)

#30
aData4_30<-subset(aData4, Temp==30)

#31
aData4_31<-subset(aData4, Temp==31)

```
stacked bar - INDIVIDUAL LARVAE by time
```{r}     
#27C 
  aData4_27$NumGen_ID<-paste(aData4_27$numclade,aData4_27$ALL.number)#new col combing num clade and ID
  
aData4_27_plot<-ggplot(aData4_27, aes(y=cells.larvae, x=NumGen_ID, fill=Symbiont),width=0.5) + 
           geom_bar(stat="identity", width=.8)+
  scale_fill_manual(values=c("#D43F3AFF","#EEA236FF","#5CB85CFF","#46B8DAFF"))+
            #scale_fill_locuszoom()+
   xlab("Larva")+
 theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        axis.text.x = element_text(angle = 90),
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(""))) +
  ggtitle("27C");aData4_27_plot

aData4_27_plot<-aData4_27_plot+
  facet_grid(~Day, 
scales = "free_x", # Let the x axis vary across facets.
space = "free_x"# Let the width of facets vary and force all bars to have the same width.
);aData4_27_plot 
    
#30C
  aData4_30$NumGen_ID<-paste(aData4_30$numclade,aData4_30$ALL.number)#new col combing num clade and ID
  
aData4_30_plot<-ggplot(aData4_30, aes(y=cells.larvae, x=NumGen_ID, fill=Symbiont),width=0.5) + 
           geom_bar(stat="identity", width=.8)+
  scale_fill_manual(values=c("#D43F3AFF","#EEA236FF","#5CB85CFF","#46B8DAFF"))+
            #scale_fill_locuszoom()+
   xlab("Larva")+
 theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        axis.text.x = element_text(angle = 90),
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(""))) +
  ggtitle("30C");aData4_30_plot

aData4_30_plot<-aData4_30_plot+
  facet_grid(~Day, 
scales = "free_x", # Let the x axis vary across facets.
space = "free_x"# Let the width of facets vary and force all bars to have the same width.
);aData4_30_plot 


#31C
  aData4_31$NumGen_ID<-paste(aData4_31$numclade,aData4_31$ALL.number)#new col combing num clade and ID
  
aData4_31_plot<-ggplot(aData4_31, aes(y=cells.larvae, x=NumGen_ID, fill=Symbiont),width=0.5) + 
           geom_bar(stat="identity", width=.8)+
  scale_fill_manual(values=c("#D43F3AFF","#EEA236FF","#5CB85CFF","#46B8DAFF"))+
            #scale_fill_locuszoom()+
   xlab("Larva")+
 theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        axis.text.x = element_text(angle = 90),
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(""))) +
  ggtitle("31C");aData4_31_plot

aData4_31_plot<-aData4_31_plot+
  facet_grid(~Day, 
scales = "free_x", # Let the x axis vary across facets.
space = "free_x"# Let the width of facets vary and force all bars to have the same width.
);aData4_31_plot
```
BY TEMP AND DAY 
```{r} 
#27C 
#Day3 3gen
aData4_27_D3_g3_plot<-ggplot(aData4_27_D3_g3, aes(y=cells.larvae, x=ALL.number, fill=Symbiont),width=0.5) + 
           geom_bar(stat="identity", width=.8)+
  scale_fill_manual(values=c("#D43F3AFF","#EEA236FF","#5CB85CFF","#46B8DAFF"))+
            #scale_fill_locuszoom()+
   xlab("Larva")+
 theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(""))) +
  ggtitle("27C_D3_3gen");aData4_27_D3_g3_plot

#day 7 3gen
aData4_27_D7_g3_plot<-ggplot(aData4_27_D7_g3, aes(y=cells.larvae, x=ALL.number, fill=Symbiont),width=0.5) + 
           geom_bar(stat="identity", width=0.8)+
  scale_fill_manual(values=c("#D43F3AFF","#EEA236FF","#5CB85CFF","#46B8DAFF"))+
            #scale_fill_locuszoom()+
   xlab("Larva")+
 theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(""))) +
  ggtitle("27C_D7_3gen");aData4_27_D7_g3_plot

#day 14 3 gen
aData4_27_D14_g3_plot<-ggplot(aData4_27_D14_g3, aes(y=cells.larvae, x=ALL.number, fill=Symbiont),width=0.5) +
           geom_bar(stat="identity", width=0.8)+
  scale_fill_manual(values=c("#D43F3AFF","#EEA236FF","#5CB85CFF","#46B8DAFF"))+
            #scale_fill_locuszoom()+
   xlab("Larva")+
 theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(""))) +
  ggtitle("27C_D14_3gen");aData4_27_D14_g3_plot

aData4_27_D3_g3_plot<-aData4_27_D3_g3_plot+ theme(legend.position = "none") #remove legend
aData4_27_D7_g3_plot<-aData4_27_D7_g3_plot+ theme(legend.position = "none") #remove legend
aData4_27_D14_g3_plot<-aData4_27_D14_g3_plot+ theme(legend.position = "none") #remove legend

grid.arrange(aData4_27_D3_g3_plot, aData4_27_D7_g3_plot,aData4_27_D14_g3_plot, nrow = 1)


#4 genera

#D3 4gen
aData4_27_D3_g4_plot<-ggplot(aData4_27_D3_g4, aes(y=cells.larvae, x=ALL.number, fill=Symbiont),width=0.5) + 
           geom_bar(stat="identity", width=.8)+
  scale_fill_manual(values=c("#D43F3AFF","#EEA236FF","#5CB85CFF","#46B8DAFF"))+
            #scale_fill_locuszoom()+
   xlab("Larva")+
 theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(""))) +
  ggtitle("27C_D3_4gen");aData4_27_D3_g4_plot

#day7  4gen
aData4_27_D7_g4_plot<-ggplot(aData4_27_D7_g4, aes(y=cells.larvae, x=ALL.number, fill=Symbiont),width=0.5) + 
           geom_bar(stat="identity", width=0.8)+
  scale_fill_manual(values=c("#D43F3AFF","#EEA236FF","#5CB85CFF","#46B8DAFF"))+
            #scale_fill_locuszoom()+
   xlab("Larva")+
 theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(""))) +
  ggtitle("27C_D7_4gen");aData4_27_D7_g4_plot

#day 14 4gen
aData4_27_D14_g4_plot<-ggplot(aData4_27_D14_g4, aes(y=cells.larvae, x=ALL.number, fill=Symbiont),width=0.5) + 
           geom_bar(stat="identity", width=0.8)+
  scale_fill_manual(values=c("#D43F3AFF","#EEA236FF","#5CB85CFF","#46B8DAFF"))+
            #scale_fill_locuszoom()+
   xlab("Larva")+
 theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(""))) +
  ggtitle("27C_D14_4gen");aData4_27_D14_g4_plot

aData4_27_D3_g4_plot<-aData4_27_D3_g4_plot+ theme(legend.position = "none") #remove legend
aData4_27_D7_g4_plot<-aData4_27_D7_g4_plot+ theme(legend.position = "none") #remove legend
aData4_27_D14_g4_plot<-aData4_27_D14_g4_plot+ theme(legend.position = "none") #remove legend

grid.arrange(aData4_27_D3_g3_plot, aData4_27_D7_g3_plot,aData4_27_D14_g3_plot,aData4_27_D3_g4_plot, aData4_27_D7_g4_plot,aData4_27_D14_g4_plot, nrow = 2)


#2 genera

#D3 2gen
aData4_27_D3_g2_plot<-ggplot(aData4_27_D3_g2, aes(y=cells.larvae, x=ALL.number, fill=Symbiont),width=0.5) + 
           geom_bar(stat="identity", width=.8)+
  scale_fill_manual(values=c("#D43F3AFF","#EEA236FF","#5CB85CFF","#46B8DAFF"))+
            #scale_fill_locuszoom()+
   xlab("Larva")+
 theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(""))) +
  ggtitle("27C_D3_2gen");aData4_27_D3_g2_plot

#day7  2gen
aData4_27_D7_g2_plot<-ggplot(aData4_27_D7_g2, aes(y=cells.larvae, x=ALL.number, fill=Symbiont),width=0.5) + 
           geom_bar(stat="identity", width=0.8)+
  scale_fill_manual(values=c("#D43F3AFF","#EEA236FF","#5CB85CFF","#46B8DAFF"))+
            #scale_fill_locuszoom()+
   xlab("Larva")+
 theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(""))) +
  ggtitle("27C_D7_2gen");aData4_27_D7_g2_plot

#day 14 2gen
#aData4_1or2_27_D14_g2_plot<-ggplot(aData4_1or2_27_D14_g2, aes(y=cells.larvae, x=ALL.number, fill=Symbiont),width=0.5) + 
           geom_bar(stat="identity", width=0.8)+
  scale_fill_manual(values=c("#D43F3AFF","#EEA236FF","#5CB85CFF","#46B8DAFF"))+
            #scale_fill_locuszoom()+
   xlab("Larva")+
 theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(""))) +
  ggtitle("27C_D14_2gen");aData4_1or2_27_D14_g2_plot

aData4_1or2_27_D3_g2_plot<-aData4_1or2_27_D3_g2_plot+ theme(legend.position = "none") #remove legend
aData4_1or2_27_D7_g2_plot<-aData4_1or2_27_D7_g2_plot+ theme(legend.position = "none") #remove legend
aData4_1or2_27_D14_g2_plot<-aData4_1or2_27_D14_g2_plot+ theme(legend.position = "none") #remove legend


#1 genera

#D3 1gen
aData4_27_D7_g1_plot<-ggplot(aData4_27_D7_g1, aes(y=cells.larvae, x=ALL.number, fill=Symbiont),width=0.5) + 
           geom_bar(stat="identity", width=.8)+
  scale_fill_manual(values=c("#D43F3AFF","#EEA236FF","#5CB85CFF","#46B8DAFF"))+
            #scale_fill_locuszoom()+
   xlab("Larva")+
 theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(""))) +
  ggtitle("27C_D3_1gen");aData4_27_D7_g1_plot

#day7  2gen
aData4_1or2_27_D7_g1_plot<-ggplot(aData4_1or2_27_D7_g1, aes(y=cells.larvae, x=ALL.number, fill=Symbiont),width=0.5) + 
           geom_bar(stat="identity", width=0.8)+
  scale_fill_manual(values=c("#D43F3AFF","#EEA236FF","#5CB85CFF","#46B8DAFF"))+
            #scale_fill_locuszoom()+
   xlab("Larva")+
 theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(""))) +
  ggtitle("27C_D7_1gen");aData4_1or2_27_D7_g1_plot

#day 14 2gen
aData4_1or2_27_D14_g1_plot<-ggplot(aData4_1or2_27_D14_g1, aes(y=cells.larvae, x=ALL.number, fill=Symbiont),width=0.5) + 
           geom_bar(stat="identity", width=0.8)+
  scale_fill_manual(values=c("#D43F3AFF","#EEA236FF","#5CB85CFF","#46B8DAFF"))+
            #scale_fill_locuszoom()+
   xlab("Larva")+
 theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(""))) +
  ggtitle("27C_D14_1gen");aData4_1or2_27_D14_g1_plot

aData4_1or2_27_D3_g1_plot<-aData4_1or2_27_D3_g1_plot+ theme(legend.position = "none") #remove legend
aData4_1or2_27_D7_g1_plot<-aData4_1or2_27_D7_g1_plot+ theme(legend.position = "none") #remove legend
aData4_1or2_27_D14_g1_plot<-aData4_1or2_27_D14_g1_plot+ theme(legend.position = "none") #remove legend


#all 1 and 2 gen at 27
grid.arrange(aData4_1or2_27_D3_g2_plot, aData4_1or2_27_D7_g2_plot,aData4_1or2_27_D14_g2_plot,aData4_1or2_27_D3_g1_plot, aData4_1or2_27_D7_g1_plot,aData4_1or2_27_D14_g1_plot, nrow = 2)






#30C 
#3gen
#D3
aData4_30_D3_g3_plot<-ggplot(aData4_30_D3_g3, aes(y=cells.larvae, x=ALL.number, fill=Symbiont),width=0.5) + 
           geom_bar(stat="identity", width=.8)+
  scale_fill_manual(values=c("#D43F3AFF","#EEA236FF","#5CB85CFF","#46B8DAFF"))+
            #scale_fill_locuszoom()+
   xlab("Larva")+
 theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(""))) +
  ggtitle("30C_D3_3gen");aData4_30_D3_g3_plot

aData4_30_D7_g3_plot<-ggplot(aData4_30_D7_g3, aes(y=cells.larvae, x=ALL.number, fill=Symbiont),width=0.5) + 
           geom_bar(stat="identity", width=0.8)+
  scale_fill_manual(values=c("#D43F3AFF","#EEA236FF","#5CB85CFF","#46B8DAFF"))+
            #scale_fill_locuszoom()+
   xlab("Larva")+
 theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(""))) +
  ggtitle("30C_D7_3gen");aData4_30_D7_g3_plot

aData4_30_D14_g3_plot<-ggplot(aData4_30_D14_g3, aes(y=cells.larvae, x=ALL.number, fill=Symbiont),width=0.5) + 
           geom_bar(stat="identity", width=0.8)+
  scale_fill_manual(values=c("#D43F3AFF","#EEA236FF","#5CB85CFF","#46B8DAFF"))+
            #scale_fill_locuszoom()+
   xlab("Larva")+
 theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(""))) +
  ggtitle("30C_D14_3gen");aData4_30_D14_g3_plot

aData4_30_D3_g3_plot<-aData4_30_D3_g3_plot+ theme(legend.position = "none") #remove legend
aData4_30_D7_g3_plot<-aData4_30_D7_g3_plot+ theme(legend.position = "none") #remove legend
aData4_30_D14_g3_plot<-aData4_30_D14_g3_plot+ theme(legend.position = "none") #remove legend

grid.arrange(aData4_30_D3_g3_plot, aData4_30_D7_g3_plot,aData4_30_D14_g3_plot, nrow = 1)


#4 genera

#D3
aData4_30_D3_g4_plot<-ggplot(aData4_30_D3_g4, aes(y=cells.larvae, x=ALL.number, fill=Symbiont),width=0.5) + 
           geom_bar(stat="identity", width=.8)+
  scale_fill_manual(values=c("#D43F3AFF","#EEA236FF","#5CB85CFF","#46B8DAFF"))+
            #scale_fill_locuszoom()+
   xlab("Larva")+
 theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(""))) +
  ggtitle("30C_D3_4gen");aData4_30_D3_g4_plot

aData4_30_D7_g4_plot<-ggplot(aData4_30_D7_g4, aes(y=cells.larvae, x=ALL.number, fill=Symbiont),width=0.5) + 
           geom_bar(stat="identity", width=0.8)+
  scale_fill_manual(values=c("#D43F3AFF","#EEA236FF","#5CB85CFF","#46B8DAFF"))+
            #scale_fill_locuszoom()+
   xlab("Larva")+
 theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(""))) +
  ggtitle("30C_D7_4gen");aData4_30_D7_g4_plot

aData4_30_D14_g4_plot<-ggplot(aData4_30_D14_g4, aes(y=cells.larvae, x=ALL.number, fill=Symbiont),width=0.5) + 
           geom_bar(stat="identity", width=0.8)+
  scale_fill_manual(values=c("#D43F3AFF","#EEA236FF","#5CB85CFF","#46B8DAFF"))+
            #scale_fill_locuszoom()+
   xlab("Larva")+
 theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(""))) +
  ggtitle("30C_D14_4gen");aData4_30_D3_g4_plot

aData4_30_D3_g4_plot<-aData4_30_D3_g4_plot+ theme(legend.position = "none") #remove legend
aData4_30_D7_g4_plot<-aData4_30_D7_g4_plot+ theme(legend.position = "none") #remove legend
aData4_30_D14_g4_plot<-aData4_30_D14_g4_plot+ theme(legend.position = "none") #remove legend

grid.arrange(aData4_30_D3_g3_plot, aData4_30_D7_g3_plot,aData4_30_D14_g3_plot,aData4_30_D3_g4_plot, aData4_30_D7_g4_plot,aData4_30_D14_g4_plot, nrow = 2)




#2 genera 30C

#D3 2gen
aData4_1or2_30_D3_g2_plot<-ggplot(aData4_1or2_30_D3_g2, aes(y=cells.larvae, x=ALL.number, fill=Symbiont),width=0.5) + 
           geom_bar(stat="identity", width=.8)+
  scale_fill_manual(values=c("#D43F3AFF","#EEA236FF","#5CB85CFF","#46B8DAFF"))+
            #scale_fill_locuszoom()+
   xlab("Larva")+
 theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(""))) +
  ggtitle("30C_D3_2gen");aData4_1or2_30_D3_g2_plot

#day7  2gen
aData4_1or2_30_D7_g2_plot<-ggplot(aData4_1or2_30_D7_g2, aes(y=cells.larvae, x=ALL.number, fill=Symbiont),width=0.5) + 
           geom_bar(stat="identity", width=0.8)+
  scale_fill_manual(values=c("#D43F3AFF","#EEA236FF","#5CB85CFF","#46B8DAFF"))+
            #scale_fill_locuszoom()+
   xlab("Larva")+
 theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(""))) +
  ggtitle("30C_D7_2gen");aData4_1or2_30_D7_g2_plot

#day 14 2gen
aData4_1or2_30_D14_g2_plot<-ggplot(aData4_1or2_30_D14_g2, aes(y=cells.larvae, x=ALL.number, fill=Symbiont),width=0.5) + 
           geom_bar(stat="identity", width=0.8)+
  scale_fill_manual(values=c("#D43F3AFF","#EEA236FF","#5CB85CFF","#46B8DAFF"))+
            #scale_fill_locuszoom()+
   xlab("Larva")+
 theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(""))) +
  ggtitle("30C_D14_2gen");aData4_1or2_30_D14_g2_plot

aData4_1or2_30_D3_g2_plot<-aData4_1or2_30_D3_g2_plot+ theme(legend.position = "none") #remove legend
aData4_1or2_30_D7_g2_plot<-aData4_1or2_30_D7_g2_plot+ theme(legend.position = "none") #remove legend
aData4_1or2_30_D14_g2_plot<-aData4_1or2_30_D14_g2_plot+ theme(legend.position = "none") #remove legend


#1 genera

#D3 1gen
aData4_1or2_30_D3_g1_plot<-ggplot(aData4_1or2_30_D3_g1, aes(y=cells.larvae, x=ALL.number, fill=Symbiont),width=0.5) + 
           geom_bar(stat="identity", width=.8)+
  scale_fill_manual(values=c("#D43F3AFF","#EEA236FF","#5CB85CFF","#46B8DAFF"))+
            #scale_fill_locuszoom()+
   xlab("Larva")+
 theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(""))) +
  ggtitle("30C_D3_1gen");aData4_1or2_30_D3_g1_plot

#day7  2gen
aData4_1or2_30_D7_g1_plot<-ggplot(aData4_1or2_30_D7_g1, aes(y=cells.larvae, x=ALL.number, fill=Symbiont),width=0.5) + 
           geom_bar(stat="identity", width=0.8)+
  scale_fill_manual(values=c("#D43F3AFF","#EEA236FF","#5CB85CFF","#46B8DAFF"))+
            #scale_fill_locuszoom()+
   xlab("Larva")+
 theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(""))) +
  ggtitle("30C_D7_1gen");aData4_1or2_30_D7_g1_plot

#day 14 2gen
aData4_1or2_30_D14_g1_plot<-ggplot(aData4_1or2_30_D14_g1, aes(y=cells.larvae, x=ALL.number, fill=Symbiont),width=0.5) + 
           geom_bar(stat="identity", width=0.8)+
  scale_fill_manual(values=c("#D43F3AFF","#EEA236FF","#5CB85CFF","#46B8DAFF"))+
            #scale_fill_locuszoom()+
   xlab("Larva")+
 theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(""))) +
  ggtitle("30C_D14_1gen");aData4_1or2_30_D14_g1_plot

aData4_1or2_30_D3_g1_plot<-aData4_1or2_30_D3_g1_plot+ theme(legend.position = "none") #remove legend
aData4_1or2_30_D7_g1_plot<-aData4_1or2_30_D7_g1_plot+ theme(legend.position = "none") #remove legend
aData4_1or2_30_D14_g1_plot<-aData4_1or2_30_D14_g1_plot+ theme(legend.position = "none") #remove legend


#all 1 and 2 gen at 30
grid.arrange(aData4_1or2_30_D3_g2_plot, aData4_1or2_30_D7_g2_plot,aData4_1or2_30_D14_g2_plot,aData4_1or2_30_D3_g1_plot, aData4_1or2_30_D7_g1_plot,aData4_1or2_30_D14_g1_plot, nrow = 2)








#########31C


#31C 
#3gen
#D3
aData4_31_D3_g3_plot<-ggplot(aData4_31_D3_g3, aes(y=cells.larvae, x=ALL.number, fill=Symbiont),width=0.5) + 
           geom_bar(stat="identity", width=.8)+
  scale_fill_manual(values=c("#D43F3AFF","#EEA236FF","#5CB85CFF","#46B8DAFF"))+
            #scale_fill_locuszoom()+
   xlab("Larva")+
 theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(""))) +
  ggtitle("31C_D3_3gen");aData4_31_D3_g3_plot

aData4_31_D7_g3_plot<-ggplot(aData4_31_D7_g3, aes(y=cells.larvae, x=ALL.number, fill=Symbiont),width=0.5) + 
           geom_bar(stat="identity", width=0.8)+
  scale_fill_manual(values=c("#D43F3AFF","#EEA236FF","#5CB85CFF","#46B8DAFF"))+
            #scale_fill_locuszoom()+
   xlab("Larva")+
 theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(""))) +
  ggtitle("31C_D7_3gen");aData4_31_D7_g3_plot



aData4_31_D3_g3_plot<-aData4_31_D3_g3_plot+ theme(legend.position = "none") #remove legend
aData4_31_D7_g3_plot<-aData4_31_D7_g3_plot+ theme(legend.position = "none") #remove legend

 grid.arrange(aData4_31_D3_g3_plot, aData4_31_D7_g3_plot,, nrow = 1)


#4 genera

#D3
aData4_31_D3_g4_plot<-ggplot(aData4_31_D3_g4, aes(y=cells.larvae, x=ALL.number, fill=Symbiont),width=0.5) + 
           geom_bar(stat="identity", width=.8)+
  scale_fill_manual(values=c("#D43F3AFF","#EEA236FF","#5CB85CFF","#46B8DAFF"))+
            #scale_fill_locuszoom()+
   xlab("Larva")+
 theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(""))) +
  ggtitle("31C_D3_4gen");aData4_31_D3_g4_plot

aData4_31_D7_g4_plot<-ggplot(aData4_31_D7_g4, aes(y=cells.larvae, x=ALL.number, fill=Symbiont),width=0.5) + 
           geom_bar(stat="identity", width=0.8)+
  scale_fill_manual(values=c("#D43F3AFF","#EEA236FF","#5CB85CFF","#46B8DAFF"))+
            #scale_fill_locuszoom()+
   xlab("Larva")+
 theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(""))) +
  ggtitle("31C_D7_4gen");aData4_31_D7_g4_plot



aData4_31_D3_g4_plot<-aData4_31_D3_g4_plot+ theme(legend.position = "none") #remove legend
aData4_31_D7_g4_plot<-aData4_31_D7_g4_plot+ theme(legend.position = "none") #remove legend

grid.arrange(aData4_31_D3_g3_plot, aData4_31_D7_g3_plot,aData4_31_D3_g4_plot, aData4_31_D7_g4_plot, nrow = 2)

#2 genera 31C

#D3 2gen
aData4_1or2_31_D3_g2_plot<-ggplot(aData4_1or2_31_D3_g2, aes(y=cells.larvae, x=ALL.number, fill=Symbiont),width=0.5) + 
           geom_bar(stat="identity", width=.8)+
  scale_fill_manual(values=c("#D43F3AFF","#EEA236FF","#5CB85CFF","#46B8DAFF"))+
            #scale_fill_locuszoom()+
   xlab("Larva")+
 theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(""))) +
  ggtitle("31C_D3_2gen");aData4_1or2_31_D3_g2_plot

#day7  2gen
aData4_1or2_31_D7_g2_plot<-ggplot(aData4_1or2_31_D7_g2, aes(y=cells.larvae, x=ALL.number, fill=Symbiont),width=0.5) + 
           geom_bar(stat="identity", width=0.8)+
  scale_fill_manual(values=c("#D43F3AFF","#EEA236FF","#5CB85CFF","#46B8DAFF"))+
            #scale_fill_locuszoom()+
   xlab("Larva")+
 theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(""))) +
  ggtitle("31C_D7_2gen");aData4_1or2_31_D7_g2_plot

#day 14 2gen
aData4_1or2_31_D14_g2_plot<-ggplot(aData4_1or2_31_D14_g2, aes(y=cells.larvae, x=ALL.number, fill=Symbiont),width=0.5) + 
           geom_bar(stat="identity", width=0.8)+
  scale_fill_manual(values=c("#D43F3AFF","#EEA236FF","#5CB85CFF","#46B8DAFF"))+
            #scale_fill_locuszoom()+
   xlab("Larva")+
 theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(""))) +
  ggtitle("31C_D14_2gen");aData4_1or2_31_D14_g2_plot

aData4_1or2_31_D3_g2_plot<-aData4_1or2_31_D3_g2_plot+ theme(legend.position = "none") #remove legend
aData4_1or2_31_D7_g2_plot<-aData4_1or2_31_D7_g2_plot+ theme(legend.position = "none") #remove legend
aData4_1or2_31_D14_g2_plot<-aData4_1or2_31_D14_g2_plot+ theme(legend.position = "none") #remove legend


#1 genera

#D3 1gen
aData4_1or2_31_D3_g1_plot<-ggplot(aData4_1or2_31_D3_g1, aes(y=cells.larvae, x=ALL.number, fill=Symbiont),width=0.5) + 
           geom_bar(stat="identity", width=.8)+
  scale_fill_manual(values=c("#D43F3AFF","#EEA236FF","#5CB85CFF","#46B8DAFF"))+
            #scale_fill_locuszoom()+
   xlab("Larva")+
 theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(""))) +
  ggtitle("31C_D3_1gen");aData4_1or2_31_D3_g1_plot

#day7  2gen
aData4_1or2_31_D7_g1_plot<-ggplot(aData4_1or2_31_D7_g1, aes(y=cells.larvae, x=ALL.number, fill=Symbiont),width=0.5) + 
           geom_bar(stat="identity", width=0.8)+
  scale_fill_manual(values=c("#D43F3AFF","#EEA236FF","#5CB85CFF","#46B8DAFF"))+
            #scale_fill_locuszoom()+
   xlab("Larva")+
 theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(""))) +
  ggtitle("31C_D7_1gen");aData4_1or2_31_D7_g1_plot

#day 14 2gen
aData4_1or2_31_D14_g1_plot<-ggplot(aData4_1or2_31_D14_g1, aes(y=cells.larvae, x=ALL.number, fill=Symbiont),width=0.5) + 
           geom_bar(stat="identity", width=0.8)+
  scale_fill_manual(values=c("#D43F3AFF","#EEA236FF","#5CB85CFF","#46B8DAFF"))+
            #scale_fill_locuszoom()+
   xlab("Larva")+
 theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(""))) +
  ggtitle("31C_D14_1gen");aData4_1or2_31_D14_g1_plot

aData4_1or2_31_D3_g1_plot<-aData4_1or2_31_D3_g1_plot+ theme(legend.position = "none") #remove legend
aData4_1or2_31_D7_g1_plot<-aData4_1or2_31_D7_g1_plot+ theme(legend.position = "none") #remove legend
aData4_1or2_31_D14_g1_plot<-aData4_1or2_31_D14_g1_plot+ theme(legend.position = "none") #remove legend


#all 1 and 2 gen at 31
grid.arrange(aData4_1or2_31_D3_g2_plot, aData4_1or2_31_D7_g2_plot,aData4_1or2_31_D3_g1_plot, aData4_1or2_31_D7_g1_plot, nrow = 2)



















```


# SI Fig S5  Plot: cells/larvae vs number of species infected per larva - shows that as more cells infected more clades infected
```{r}     
#ALL_RelA_Infect2  ALLnumb and number of clades df
#ALLcast_9000_cast2c <- df for 

#get cell counts for ALL number for correct df
ALLcast_9000_cast2cAvars2<-c("ALL.number","Temp","Day","cells.larvae","Pot") #select cols to keep
ALLcast_9000_cast4<-ALLcast_9000_cast2c[ALLcast_9000_cast2cAvars2] # new df

#merge 2 dfs
CellsByNum<-merge(ALL_RelA_Infect2,ALLcast_9000_cast4, by=c("ALL.number", "Temp", "Day", "Pot")) 
CellsByNum$ALL.number<-as.factor(CellsByNum$ALL.number)
#CellsByNum$numclade<-as.factor(CellsByNum$numclade)
CellsByNum$cells.larvae_log<-log10(CellsByNum$cells.larvae+1)

#plot 
CellsByNum_27C<-subset(CellsByNum, Temp=="27")
CellsByNum_30C<-subset(CellsByNum, Temp=="30")
CellsByNum_31C<-subset(CellsByNum, Temp=="31")

#plot 27 
CellsByNum_plot27<-ggplot(data=CellsByNum_27C, aes(x=numclade, y=cells.larvae_log, color=Day)) +
  #geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
             #   width=0.1, show.legend = T)+
  geom_point( size=4, show.legend = T)+ 
      scale_color_manual(values=c('#D43F3AFF','#EEA236FF','#5CB85CFF','#46B8DAFF'))+
      #geom_smooth(method = lm )+
      # geom_point(shape = 1,size = 4,colour = "black")+
  #geom_line(linetype="dotted")+
  xlab("cells/larvae") + #Label the X Axis 
  #ylim(0, 1) + #set Y limits 
       #  scale_x_continuous(breaks=seq(0, 14, 2), limits =c(0,14))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("number of clades"))) +
  ggtitle("cells larva- by number clades")+
  theme(plot.title = element_text(size=20));CellsByNum_plot27

#plot 30 
CellsByNum_plot30<-ggplot(data=CellsByNum_30C, aes(x=numclade, y=cells.larvae_log , color=Day)) +
  #geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
             #   width=0.1, show.legend = T)+
  geom_point( size=4, show.legend = T)+ 
      scale_color_manual(values=c('#D43F3AFF','#EEA236FF','#5CB85CFF','#46B8DAFF'))+
      # geom_point(shape = 1,size = 4,colour = "black")+
  #geom_line(linetype="dotted")+
  xlab("cells/larva") + #Label the X Axis 
  #ylim(0, 1) + #set Y limits 
       #  scale_x_continuous(breaks=seq(0, 14, 2), limits =c(0,14))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("number of claes"))) +
  ggtitle("cells larva- by number clades 30")+
  theme(plot.title = element_text(size=20));CellsByNum_plot30

#plot 31
CellsByNum_plot31<-ggplot(data=CellsByNum_31C, aes(x=numclade, y=cells.larvae_log , color=Day)) +
  #geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
             #   width=0.1, show.legend = T)+
  geom_point( size=4, show.legend = T)+ 
      scale_color_manual(values=c('#D43F3AFF','#EEA236FF','#5CB85CFF','#46B8DAFF'))+
    #geom_smooth(method = "lm")+
      # geom_point(shape = 1,size = 4,colour = "black")+
  #geom_line(linetype="dotted")+
  xlab("cells/larva") + #Label the X Axis 
  #ylim(0, 1) + #set Y limits 
       #  scale_x_continuous(breaks=seq(0, 14, 2), limits =c(0,14))+
  theme_bw() + #Set the background color

  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("number of clades"))) +
  ggtitle("cells larva- by number clades31")+
  theme(plot.title = element_text(size=20));CellsByNum_plot31


CellsByNum_plot27<-CellsByNum_plot27+ theme(legend.position = "none") #remove legend
CellsByNum_plot30<-CellsByNum_plot30+ theme(legend.position = "none") #remove legend
#CellsByNum_plot31<-CellsByNum_plot31+ theme(legend.position = "none") #remove legend

grid.arrange(CellsByNum_plot27, CellsByNum_plot30,CellsByNum_plot31, nrow = 1)


#MODELS
hist(CellsByNum$cells.larvae_log) #normal

CellsByNum$numclade<-as.factor(as.character(CellsByNum$numclade))
CellsByNum_model<-lmer(cells.larvae_log~numclade*Day*Temp+(1|Pot), CellsByNum)
anova(CellsByNum_model)
qqPlot(residuals(CellsByNum_model))   # good
  emm<-emmeans(CellsByNum_model,  ~ numclade*Temp, adjust="Tukey")
    cld(emm)
    pairs(emm)
```



#NMDS Fig 5
```{r}  
library(ggplot2)
library(vegan)
library(grid)

#df: ALL_RelAb_a this is relA
ALL_RelAb_a_NMDS<-ALL_RelAb_a #make copy
ALL_RelAb_a_NMDS<-na.omit(ALL_RelAb_a_NMDS) #remove NAs
ALL_RelAb_a_NMDS$Cladocopium_arc<-asin(sqrt(ALL_RelAb_a_NMDS$Cladocopium))
ALL_RelAb_a_NMDS$Durusdinium_arc<-asin(sqrt(ALL_RelAb_a_NMDS$Durusdinium))
ALL_RelAb_a_NMDS$Fugacium_arc<-asin(sqrt(ALL_RelAb_a_NMDS$Fugacium))
ALL_RelAb_a_NMDS$Gerakladium_arc<-asin(sqrt(ALL_RelAb_a_NMDS$Gerakladium))


ALL_RelAb_a_NMDS<-subset(ALL_RelAb_a_NMDS, select=-c(Cladocopium,Durusdinium,Fugacium,Gerakladium))

#make community matrix - extract columns with abundance information
com = ALL_RelAb_a_NMDS[,5:ncol(ALL_RelAb_a_NMDS)]
#turn abundance data frame into a matrix
m_com = as.matrix(com)

set.seed(144)
nmds = metaMDS(m_com, distance = "bray") #stress 0.09687447 
nmds
plot(nmds)

#extract NMDS scores (x and y coordinates)
data.scores = as.data.frame(scores(nmds))
#add columns to data frame 
data.scores$ALL.number = ALL_RelAb_a_NMDS$ALL.number
data.scores$Temp = ALL_RelAb_a_NMDS$Temp
data.scores$Day = ALL_RelAb_a_NMDS$Day
 
head(data.scores)
#write.csv(data.scores, "data.scores.csv")
#write.csv(ALL_RelAb_a_NMDS, "ALL_RelAb_a_NMDS.csv")

#Plots
#Make vectors
#environmental data - reef and species arrows
data.env <- as.data.frame(ALL_RelAb_a_NMDS[,1:2]) #Make a dataframe of all the environmental variables you want - here I used specific columns
envfit <- envfit(nmds, data.env, perm = 999) #run an envfit on the NMDS you made above
scores(envfit, "factors") #make sure you get scores for your enivronmental variables
envfit.df <- scores(envfit, display = c("factors")) #I assume we are making a dataframe here
envfit.df <- envfit.df*vegan:::ordiArrowMul(envfit.df) #Do a little arrow code from vegan
envfit.df <- as.data.frame(envfit.df) #make sure it's a data frame

#create colors
Palette1<- c("blue", "orange","red") 
Palette2<- c("green", "magenta","cyan")

#full date*temp
xx = ggplot(data.scores, aes(x = NMDS1, y = NMDS2)) + 
    geom_point(size = 2, aes( shape = Day, colour = Temp))+ 
    theme(axis.text.y = element_text(colour = "black", size = 12, face = "bold"), 
    axis.text.x = element_text(colour = "black", face = "bold", size = 12), 
    legend.text = element_text(size = 12, face ="bold", colour ="black"), 
    legend.position = "right", axis.title.y = element_text(face = "bold", size = 14), 
    axis.title.x = element_text(face = "bold", size = 14, colour = "black"), 
    legend.title = element_text(size = 14, colour = "black", face = "bold"), 
    panel.background = element_blank(), panel.border = element_rect(colour = "black", fill = NA, size = 1.2),
    legend.key=element_blank()) + 
    labs(x = "NMDS1", colour = "Temp", y = "NMDS2", shape = "Day")  +
  scale_fill_manual(values=Palette1) +  
  scale_colour_manual(values=Palette1)+
 stat_ellipse(geom = "polygon",level=.70, alpha = .2, aes(fill=Temp))+
  stat_ellipse(level=.70,  aes(x=NMDS1, y=NMDS2,color=Temp))+
  coord_fixed(ratio = .95);xx


#Day ellip (float in corner of above plot)
xxDay = ggplot(data.scores, aes(x = NMDS1, y = NMDS2)) + 
    geom_point(size = 2, aes(shape = Temp, colour = Day))+ 
    theme(axis.text.y = element_text(colour = "black", size = 12, face = "bold"), 
    axis.text.x = element_text(colour = "black", face = "bold", size = 12), 
    legend.text = element_text(size = 12, face ="bold", colour ="black"), 
    legend.position = "right", axis.title.y = element_text(face = "bold", size = 14), 
    axis.title.x = element_text(face = "bold", size = 14, colour = "black"), 
    legend.title = element_text(size = 14, colour = "black", face = "bold"), 
    panel.background = element_blank(), panel.border = element_rect(colour = "black", fill = NA, size = 1.2),
    legend.key=element_blank()) + 
    labs(x = "NMDS1", colour = "Day", y = "NMDS2", shape = "Temp")  + 
  scale_fill_manual(values=Palette2) +  
  scale_colour_manual(values=Palette2)+
 stat_ellipse(geom = "polygon",level=.75, alpha = .2, aes(fill=Day))+
  stat_ellipse(level=.75,  aes(x=NMDS1, y=NMDS2, color=Day));xxDay
  
#NMDS by days
data.scores_d3<-subset(data.scores, Day==3)
# day 3 only
xday3 = ggplot(data.scores_d3, aes(x = NMDS1, y = NMDS2)) + 
    geom_point(size = 2, aes( shape = Temp, colour = Temp))+ 
    theme(axis.text.y = element_text(colour = "black", size = 12, face = "bold"), 
    axis.text.x = element_text(colour = "black", face = "bold", size = 12), 
    legend.text = element_text(size = 12, face ="bold", colour ="black"), 
    legend.position = "right", axis.title.y = element_text(face = "bold", size = 14), 
    axis.title.x = element_text(face = "bold", size = 14, colour = "black"), 
    legend.title = element_text(size = 14, colour = "black", face = "bold"), 
    panel.background = element_blank(), panel.border = element_rect(colour = "black", fill = NA, size = 1.2),
    legend.key=element_blank()) + 
    labs(x = "NMDS1", colour = "Temp", y = "NMDS2", shape = "Day")  + 
scale_fill_manual(values=Palette1) +  
  scale_colour_manual(values=Palette1)+  stat_ellipse(geom = "polygon",level=.75, alpha = .2, aes(fill=Temp))+
  stat_ellipse(level=.75,  aes(x=NMDS1, y=NMDS2,color=Temp));xday3

data.scores_d7<-subset(data.scores, Day==7)
# day 7 only
xday7 = ggplot(data.scores_d7, aes(x = NMDS1, y = NMDS2)) + 
    geom_point(size = 2, aes( shape = Temp, colour = Temp))+ 
    theme(axis.text.y = element_text(colour = "black", size = 12, face = "bold"), 
    axis.text.x = element_text(colour = "black", face = "bold", size = 12), 
    legend.text = element_text(size = 12, face ="bold", colour ="black"), 
    legend.position = "right", axis.title.y = element_text(face = "bold", size = 14), 
    axis.title.x = element_text(face = "bold", size = 14, colour = "black"), 
    legend.title = element_text(size = 14, colour = "black", face = "bold"), 
    panel.background = element_blank(), panel.border = element_rect(colour = "black", fill = NA, size = 1.2),
    legend.key=element_blank()) + 
    labs(x = "NMDS1", colour = "Temp", y = "NMDS2", shape = "Day")  + 
    scale_fill_manual(values=Palette1) +  
  scale_colour_manual(values=Palette1)+  stat_ellipse(geom = "polygon",level=.75, alpha = .2, aes(fill=Temp))+
  stat_ellipse(level=.75,  aes(x=NMDS1, y=NMDS2,color=Temp))

xday7



data.scores_d14<-subset(data.scores, Day==14)
# day 14 only
xday14 = ggplot(data.scores_d14, aes(x = NMDS1, y = NMDS2)) + 
    geom_point(size = 2, aes( shape = Temp, colour = Temp))+ 
    theme(axis.text.y = element_text(colour = "black", size = 12, face = "bold"), 
    axis.text.x = element_text(colour = "black", face = "bold", size = 12), 
    legend.text = element_text(size = 12, face ="bold", colour ="black"), 
    legend.position = "right", axis.title.y = element_text(face = "bold", size = 14), 
    axis.title.x = element_text(face = "bold", size = 14, colour = "black"), 
    legend.title = element_text(size = 14, colour = "black", face = "bold"), 
    panel.background = element_blank(), panel.border = element_rect(colour = "black", fill = NA, size = 1.2),
    legend.key=element_blank()) + 
    labs(x = "NMDS1", colour = "Temp", y = "NMDS2", shape = "Day")  + 
    scale_fill_manual(values=Palette1) +  
  scale_colour_manual(values=Palette1)+  stat_ellipse(geom = "polygon",level=.75, alpha = .2, aes(fill=Temp))+
  stat_ellipse(level=.75,  aes(x=NMDS1, y=NMDS2,color=Temp));xday14

xday3<-xday3+ theme(legend.position = "none") #remove legend
xday7<-xday7+ theme(legend.position = "none") #remove legend
xday14<-xday14+ theme(legend.position = "none") #remove legend


grid.arrange(xday3, xday7, xday14, nrow = 2) 

```
#PERMANOVAs Table 2
```{r}
#my matrix is m_com
#full 
m_com.dist<-vegdist(m_com, method='bray') #make dissimilarity matrix
set.seed(36) #reproducible results
polyculture.div<-adonis2(m_com.dist~Temp*Day, data=ALL_RelAb_a_NMDS, permutations = 999, method="bray")

polyculture.div

#by day, subset df: ALL_RelAb_a_NMDS
#D3
ALL_RelAb_a_NMDS_D3<-subset(ALL_RelAb_a_NMDS, Day=="3")
com_D3 = ALL_RelAb_a_NMDS_D3[,5:ncol(ALL_RelAb_a_NMDS_D3)]
#turn abundance data frame into a matrix
m_com_D3 = as.matrix(com_D3)
m_com_D3.dist<-vegdist(m_com_D3, method='bray') #make dissimilarity matrix
set.seed(36) #reproducible results
polyculture.div<-adonis2(m_com_D3.dist~Temp, data=ALL_RelAb_a_NMDS_D3, permutations = 999, method="bray")

#To check for homogeneity of dispersions, first create a betadisper object
disp <- betadisper(m_com_D3.dist, ALL_RelAb_a_NMDS_D3$Temp, type = "centroid")
#The following runs the test, default is 999 permuations
permutest(disp)
#visualise it using a boxplot
par(pty = 's')
boxplot(disp)
plot(disp, hull=FALSE, ellipse=TRUE) ##sd ellipse

#D7
ALL_RelAb_a_NMDS_D7<-subset(ALL_RelAb_a_NMDS, Day=="7")
com_D7 = ALL_RelAb_a_NMDS_D7[,5:ncol(ALL_RelAb_a_NMDS_D7)]
#turn abundance data frame into a matrix
m_com_D7 = as.matrix(com_D7)
m_com_D7.dist<-vegdist(m_com_D7, method='bray') #make dissimilarity matrix
set.seed(76) #reproducible results
polyculture.div<-adonis2(m_com_D7.dist~Temp, data=ALL_RelAb_a_NMDS_D7, permutations = 999, method="bray")

#To check for homogeneity of dispersions, first create a betadisper object
disp <- betadisper(m_com_D7.dist, ALL_RelAb_a_NMDS_D7$Temp, type = "centroid")
#The following runs the test, default is 999 permuations
permutest(disp)
#visualise it using a boxplot
par(pty = 's')
boxplot(disp)
plot(disp, hull=FALSE, ellipse=TRUE) ##sd ellipse

#D14
ALL_RelAb_a_NMDS_D14<-subset(ALL_RelAb_a_NMDS, Day=="14")
com_D14 = ALL_RelAb_a_NMDS_D14[,5:ncol(ALL_RelAb_a_NMDS_D14)]
#turn abundance data frame into a matrix
m_com_D14 = as.matrix(com_D14)
m_com_D14.dist<-vegdist(m_com_D14, method='bray') #make dissimilarity matrix
set.seed(96) #reproducible results
polyculture.div<-adonis2(m_com_D14.dist~Temp, data=ALL_RelAb_a_NMDS_D14, permutations = 999, method="bray")
polyculture.div

#To check for homogeneity of dispersions, first create a betadisper object
disp <- betadisper(m_com_D14.dist, ALL_RelAb_a_NMDS_D14$Temp, type = "centroid")
#The following runs the test, default is 999 permuations
permutest(disp)
#visualise it using a boxplot
par(pty = 's')
boxplot(disp)
plot(disp, hull=FALSE, ellipse=TRUE) ##sd ellipse

```